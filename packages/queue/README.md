# @stratix/queue

Stratix框架的队列管理插件，提供高效、可靠的分布式任务处理解决方案。

## 功能特性

- 默认集成 BullMQ，支持切换到其他队列实现
- 支持延迟任务、重复任务和计划任务
- 自动重试机制和失败策略
- 任务优先级和并发控制
- 支持任务依赖关系（工作流）
- 任务进度跟踪和事件系统
- 分布式锁和原子操作
- 监控和统计功能
- 优雅关闭和恢复机制

## 性能优化

本插件实现了以下性能优化：

1. **连接池优化**
   - Redis连接池复用，减少连接开销
   - 连接状态管理和自动复用

2. **批量操作优化**
   - 大批量任务分批处理，避免Redis阻塞
   - 并行批处理策略，提高吞吐量

3. **缓存和序列化优化**
   - 任务状态缓存，减少查询次数
   - 优化序列化/反序列化过程

4. **指标收集和监控**
   - 实时性能指标收集
   - 吞吐量和延迟监控

## 错误处理

完善的错误处理机制：

1. **统一错误处理**
   - 标准化错误类型和消息
   - 详细的错误上下文信息

2. **智能重试策略**
   - 多种重试策略（固定间隔、指数退避、自定义）
   - 自动错误分类和处理

3. **故障恢复**
   - 连接断开自动恢复
   - 优雅关闭和资源释放

## 性能测试

内置性能测试工具，可通过以下方式运行：

```bash
# 安装依赖
npm install

# 运行性能测试
node dist/test-performance.js
```

测试结果示例：

```
开始性能测试: add-single-job (100 次迭代, 并发度 10)
性能测试结果: add-single-job
- 总时间: 1532ms
- 吞吐量: 65.27 操作/秒
- 成功率: 100.00%
- 平均延迟: 146.32ms
- 95百分位延迟: 216.20ms
- 99百分位延迟: 253.84ms

开始性能测试: add-bulk-jobs (10 次迭代, 并发度 2)
性能测试结果: add-bulk-jobs
- 总时间: 2341ms
- 吞吐量: 4.27 操作/秒
- 成功率: 100.00%
- 平均延迟: 452.65ms
- 95百分位延迟: 570.05ms
- 99百分位延迟: 592.10ms
```

## 使用方法

请参阅[使用指南](./docs/feature/queue/queue-usage.md)了解详细的使用方法。 