<!-- Do not edit this file. It is automatically generated by API Documenter. -->

[Home](./index.md) &gt; [@stratix/utils](./utils.md) &gt; [performance\_2](./utils.performance_2.md) &gt; [batch](./utils.performance_2.batch.md)

## performance\_2.batch() function

创建批处理函数，将多个单项操作合并为批量操作

此函数将单个项的处理转换为批量处理，当累积足够的项或达到指定的延迟时间时， 会自动触发批量处理。适用于优化API请求或数据库操作等场景。

**Signature:**

```typescript
export declare function batch<T, R>(fn: (items: T[]) => Promise<R[]>, options?: BatchOptions): (item: T) => Promise<R>;
```

## Parameters

<table><thead><tr><th>

Parameter


</th><th>

Type


</th><th>

Description


</th></tr></thead>
<tbody><tr><td>

fn


</td><td>

(items: T\[\]) =&gt; Promise&lt;R\[\]&gt;


</td><td>

处理批量项的函数，接收项数组，返回结果数组


</td></tr>
<tr><td>

options


</td><td>

[BatchOptions](./utils.performance_2.batchoptions.md)


</td><td>

_(Optional)_ 批处理选项


</td></tr>
</tbody></table>
**Returns:**

(item: T) =&gt; Promise&lt;R&gt;

处理单个项的函数，内部会批量处理

## Exceptions

`Error` 如果批处理函数返回的结果数量与输入项数量不匹配

## Remarks

版本: 1.0.0 分类: 性能优化

## Example


```typescript
// 基本使用 - 将单个API请求合并为批量请求
const batchFetchUser = batch(
  async (userIds) => {
    // 一次请求获取多个用户
    const response = await fetch(`/api/users?ids=${userIds.join(',')}`);
    return response.json();
  },
  { maxBatchSize: 50, maxDelay: 20 }
);

// 现在可以单独调用，但内部会合并请求
const user1 = await batchFetchUser(101);
const user2 = await batchFetchUser(102);
const user3 = await batchFetchUser(103);
// 这些请求会合并为一个批量请求

// 自定义批量选项
const batchInsert = batch(
  async (records) => {
    // 批量插入数据库
    const results = await db.batchInsert('users', records);
    return results.map(r => r.id);
  },
  { maxBatchSize: 500, maxDelay: 50 }
);

// 错误处理
try {
  const id = await batchInsert({ name: 'Test' });
} catch (error) {
  // 如果批处理中有一个项失败，所有相关项都会失败
  console.error('批量插入失败:', error);
}
```

