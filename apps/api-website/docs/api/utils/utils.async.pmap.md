<!-- Do not edit this file. It is automatically generated by API Documenter. -->

[Home](./index.md) &gt; [@stratix/utils](./utils.md) &gt; [async](./utils.async.md) &gt; [pMap](./utils.async.pmap.md)

## async.pMap() function

将数组中的每个项目映射到异步函数，并控制并发执行数量

类似于Array.prototype.map，但用于处理异步映射函数，并可以限制并发执行的数量。 当数据量大或每个操作消耗资源较多时，控制并发数可以避免资源耗尽。

**Signature:**

```typescript
export declare function pMap<T, R>(array: T[], mapper: (item: T, index: number, array: T[]) => Promise<R>, options?: PMapOptions): Promise<R[]>;
```

## Parameters

<table><thead><tr><th>

Parameter


</th><th>

Type


</th><th>

Description


</th></tr></thead>
<tbody><tr><td>

array


</td><td>

T\[\]


</td><td>

要映射的数组


</td></tr>
<tr><td>

mapper


</td><td>

(item: T, index: number, array: T\[\]) =&gt; Promise&lt;R&gt;


</td><td>

异步映射函数，接收数组元素、索引和原数组


</td></tr>
<tr><td>

options


</td><td>

[PMapOptions](./utils.async.pmapoptions.md)


</td><td>

_(Optional)_ 并发映射配置选项


</td></tr>
</tbody></table>
**Returns:**

Promise&lt;R\[\]&gt;

Promise，解析为映射结果的数组，顺序与输入数组一致

## Exceptions

`TypeError` 如果输入不是数组、mapper不是函数或concurrency不是正数

如果任何一个mapper函数执行失败，整个操作都会失败

## Remarks

版本: 1.0.0 分类: 并发控制

## Example


```typescript
// 基本使用 - 并发获取多个URL，限制并发数为3
const urls = [
  'https://example.com/1',
  'https://example.com/2',
  'https://example.com/3',
  'https://example.com/4',
  'https://example.com/5'
];

const results = await pMap(
  urls,
  url => fetch(url).then(r => r.json()),
  { concurrency: 3 }
);

// 处理数组索引
const items = ['a', 'b', 'c'];
const withIndexes = await pMap(
  items,
  async (item, index) => {
    return { item, index, timestamp: Date.now() };
  }
);

// 错误处理
try {
  await pMap(apis, async (api) => {
    const response = await fetch(api.url);
    if (!response.ok) {
      throw new Error(`API ${api.name} failed with ${response.status}`);
    }
    return response.json();
  });
} catch (error) {
  // 任何一个映射函数失败，整个操作都会失败
  console.error('映射操作失败:', error);
}
```

