我重构了taskService服务，现在要使用taskService重写完成同步的任务（代码位于packages/tasks/src/services/taskService.ts），阅读taskService所有的代码和功能。
重新实现全量同步和增量同步的任务树和功能，在apps/icalink-sync/src/plugin/sync/service/ 里
数据库使用repositories里的功能
注意尽量使用函数式编程方式
下面是任务树的描述，下面4种方式都需要处理

# 同步任务
## 同步任务树结构：
 📦 全量同步 (根任务)
 ├── 🏗️ 聚合任务
 ├── ⚙️ 获取课程任务
 │   └── 读取数据
 ├── 🚀 同步课程1
 │   ├── 🏗️ 创建课程签到表
 │   │   ├── 检查课程表记录是否存在 
 │   │   └── 创建或更新课程签到表记录
 │   ├── 📦 获取课程教师数组
 │   ├── 📦 获取课程学生数组
 │   ├── 📦 教师同步任务（注册成功回调，任务成功后执行修改中间表状态1）
 │   │   ├── 教师1同步（注册成功回调，队列任务执行成功后任务状态成功）
 │   │   │    ├── 查询教师日历id
 │   │   │    ├── 日历是否存在，不存在则创建
 │   │   │    ├── 查询教师日程信息是否存在
 │   │   │    └── 将创建日程加入到队列
 │   │   │    。。。
 │   ├── 📦 学生同步任务（注册成功回调，任务成功后执行修改中间表状态2）
 │   │   ├── 学生1同步（注册成功回调，队列任务执行成功后任务状态成功）
 │   │   │    ├── 查询学生日历id
 │   │   │    ├── 日历是否存在，不存在则创建
 │   │   │    ├── 查询学生日程信息是否存在
 │   │   │    └── 将创建日程加入到队列
 │   │   │    。。。
 │   │   ├── 学生n同步（注册成功回调，队列任务执行成功后任务状态成功）
 │   │   │    ├── 查询学生日历id
 │   │   │    ├── 日历是否存在，不存在则创建
 │   │   │    ├── 查询学生日程信息是否存在
 │   │   │    └── 将创建日程加入到队列
 │...
 ├── 🚀 同步课程n
     └── 🌐 同上

## 新方案修改后的同步任务树：
 📦 全量同步 (根任务)
 ├── 🏗️ 聚合任务
 ├── ⚙️ 获取课程任务
 │   └── 读取数据
 ├── 🚀 同步课程1（注册成功方法修改聚合表和中间表状态）
 │   ├── 1. 检查课程是否存在，不存在则创建，存在则继续
 │   ├── 2. 创建课程服务
 │   │   ├── 1. 检查课程表记录是否存在 
 │   │   └── 2. 创建或更新课程表
 │   ├──  
 │   ├── 3. 获取课程参与者列表（教师/学生）
 │   ├── 4. 将创建日程加入到队列
 │...
 ├── 🚀 同步课程n
     └── 🌐 同上

# 新方案
## 修改前的增量任务
 📦 增量同步 (根任务)
 ├── 🏗️ 聚合任务（is_null）
 ├── ⚙️ 删除课程任务
 │   ├── 获取课程列表
 │   ├── 删除课程任务1（注册成功方法修改聚合表和中间表状态4，同时删除课程签到表记录）
 │   │   ├── 1. 获取课程教师数组
 │   │   ├── 2. 获取课程学生数组
 │   │   ├── 3. 修改聚合表和中间表状态为3
 │   │   ├── 3. 删除学生日程任务（子任务完成后自动完成）
 │   │   │      ├── 删除学生1（订阅队列任务完成）
 │   │   │           ├── 读取学生日历（如果没有日历则创建日历）
 │   │   │           └── 将删除学生1日程加入队列
 │   │   │      ├── 。。。
 │   │   │      └── 删除学生n
 │   │   └── 4. 删除教师日程任务
 │   │   │      ├── 将删除教师1日程加入队列（订阅队列任务完成）
 │   │   │      ├── 。。。
 │   │   │      └── 删除教师n日程
 │   │ 。。。。
 │   ├── 删除课程任务n（注册成功方法修改聚合表和中间表状态）
 ├── ⚙️ 聚合课程任务（is_4）
 ├── 🚀 同步课程1
 │   ├── 🏗️ 创建课程签到表
 │   │   ├── 检查课程表记录是否存在 
 │   │   └── 创建或更新课程签到表记录
 │   ├── 📦 获取课程教师数组
 │   ├── 📦 获取课程学生数组
 │   ├── 📦 教师同步任务（注册成功回调，任务成功后执行修改中间表状态1）
 │   │   ├── 教师1同步（注册成功回调，队列任务执行成功后任务状态成功）
 │   │   │    ├── 查询教师日历id
 │   │   │    ├── 日历是否存在，不存在则创建
 │   │   │    ├── 查询教师日程信息是否存在
 │   │   │    └── 将创建日程加入到队列
 │   │   │    。。。
 │   ├── 📦 学生同步任务（注册成功回调，任务成功后执行修改中间表状态2）
 │   │   ├── 学生1同步（注册成功回调，队列任务执行成功后任务状态成功）
 │   │   │    ├── 查询学生日历id
 │   │   │    ├── 日历是否存在，不存在则创建
 │   │   │    ├── 查询学生日程信息是否存在
 │   │   │    └── 将创建日程加入到队列
 │   │   │    。。。
 │   │   ├── 学生n同步（注册成功回调，队列任务执行成功后任务状态成功）
 │   │   │    ├── 查询学生日历id
 │   │   │    ├── 日历是否存在，不存在则创建
 │   │   │    ├── 查询学生日程信息是否存在
 │   │   │    └── 将创建日程加入到队列
 │...
 ├── 🚀 同步课程n
     └── 🌐 同上

## 修改后的增量任务树：
📦 增量同步 (根任务)
 ├── 🏗️ 聚合任务（is_null）
 ├── ⚙️ 删除课程任务
 │   ├── 获取课程列表
 │   ├── 删除课程任务1（注册成功方法修改聚合表和中间表状态4，同时删除课程签到表记录）
 │   │   ├── 1. 修改聚合表状态为3
 │   │   ├── 2. 读取课程日历
 │   │   └── 3. 读取课程信息
 │   │   └── 4. 将删除日程加入到队列
 │   │ ...
 │   ├── 删除课程任务n（注册成功方法修改聚合表和中间表状态）
 ├── ⚙️ 聚合课程任务（is_4）
 │   └── 读取数据
 ├── 🚀 同步课程1（注册成功方法修改聚合表和中间表状态）
 │   ├── 1. 检查课程是否存在，不存在则创建，存在则继续
 │   ├── 2. 创建课程签到表
 │   │   ├── 1. 检查课程签到表记录是否存在 
 │   │   └── 2. 创建或更新课程表
 │   ├── 3. 获取课程参与者列表（教师/学生）
 │   ├── 4. 将创建日程加入到队列
 │...
 ├── 🚀 同步课程n
     └── 🌐 同上

// 启动根任务
await newTaskService.startTask('project-deploy-root', '全量同步');

// 执行结果：
// 1. 所有 PENDING 状态的任务变为 RUNNING
// 2. 每个任务的 onStart 方法被调用
// 3. 叶子节点开始异步执行 run 方法