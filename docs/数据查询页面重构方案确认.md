# æ•°æ®æŸ¥è¯¢é¡µé¢é‡æ„æ–¹æ¡ˆç¡®è®¤

## âœ… æ¥å£ä¿¡æ¯ç¡®è®¤

### 1. ç¼ºå‹¤å†å²æ˜ç»†è¡¨

**âœ… åç«¯æ¥å£**ï¼š`GET /api/icalink/v1/stats/absent-history`

**âœ… æŸ¥è¯¢å‚æ•°**ï¼š
```typescript
{
  page?: number;          // é¡µç ï¼ˆé»˜è®¤1ï¼‰
  pageSize?: number;      // æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤20ï¼Œæœ€å¤§100ï¼‰
  searchKeyword?: string; // æœç´¢å…³é”®è¯ï¼ˆå­¦ç”Ÿå§“åã€å­¦ç”ŸIDã€è¯¾ç¨‹åç§°ã€è¯¾ç¨‹ä»£ç ã€ç¼ºå‹¤ç±»å‹ï¼‰
  teachingWeek?: number;  // æ•™å­¦å‘¨ç­›é€‰
  sortField?: string;     // æ’åºå­—æ®µ
  sortOrder?: 'asc' | 'desc'; // æ’åºæ–¹å‘
}
```

**âœ… å“åº”æ ¼å¼**ï¼š
```typescript
{
  success: boolean;
  data: {
    data: AbsentStudentRelation[];
    total: number;
    page: number;
    pageSize: number;
    totalPages: number;
  };
  error?: string;
}
```

**âœ… æ•°æ®ç±»å‹**ï¼š
```typescript
interface AbsentStudentRelation {
  id: number;
  course_checkin_stats_id: number;
  course_id: number;
  course_code: string;
  course_name: string;
  student_id: string;
  student_name: string;
  school_name: string;
  class_name: string;
  major_name: string;
  absence_type: string;
  semester: string;
  teaching_week: number;
  weekday: number;
  period: number;
  time_slot: string;
  leave_reason: string | null;
  created_at: string;
  updated_at: string;
}
```

**âœ… å‰ç«¯è·¯ç”±**ï¼š`/data-query/absent-history`

**âœ… API è°ƒç”¨æ–¹æ³•**ï¼šå·²å­˜åœ¨äº `apps/agendaedu-web/src/lib/stats-api.ts`
```typescript
statsApiService.getAbsentHistory(params)
```

**âœ… é¡µé¢ç»„ä»¶**ï¼šå·²å­˜åœ¨äº `apps/agendaedu-web/src/routes/_authenticated/data-query/absent-history.tsx`

---

## ğŸ“Š å®Œæ•´çš„5ä¸ªé¡µé¢æ˜ å°„

| åºå· | é¡µé¢åç§° | åç«¯æ¥å£ | å‰ç«¯è·¯ç”± | ç»„ä»¶æ–‡ä»¶ | APIæ–¹æ³• | çŠ¶æ€ |
|------|---------|---------|---------|---------|---------|------|
| 1 | ç¼ºå‹¤å†å²æ˜ç»†è¡¨ | `/api/icalink/v1/stats/absent-history` | `/data-query/absent-history` | `absent-history.tsx` | `getAbsentHistory()` | âœ… å·²å­˜åœ¨ |
| 2 | è¯¾ç¨‹å†å²ç»Ÿè®¡è¡¨ | `/api/icalink/v1/stats/course-stats` | `/data-query/course-stats` | `course-stats.tsx` | `getCourseStats()` | âœ… å·²å­˜åœ¨ |
| 3 | å­¦ç”Ÿå†å²ç»Ÿè®¡è¡¨ | `/api/icalink/v1/stats/student-stats` | `/data-query/student-stats` | `student-stats.tsx` | `getStudentStats()` | âœ… å·²å­˜åœ¨ |
| 4 | å­¦ç”Ÿå†å²ç»Ÿè®¡è¯¦æƒ…è¡¨ | `/api/icalink/v1/stats/student-stats-details` | `/data-query/student-stats-details` | `student-stats-details.tsx` | `getStudentStatsDetails()` | âœ… å·²å­˜åœ¨ |
| 5 | æ•™å­¦ç­è¡¨ | `/api/icalink/v1/stats/teaching-class` | `/data-query/teaching-class` | `teaching-class.tsx` | `getTeachingClass()` | âœ… å·²å­˜åœ¨ |

---

## ğŸ¯ å½“å‰çŠ¶æ€åˆ†æ

### âœ… å·²å®Œæˆçš„éƒ¨åˆ†

1. **åç«¯æ¥å£**ï¼š5ä¸ªç»Ÿè®¡æ¥å£å…¨éƒ¨å®ç°å¹¶æ­£å¸¸å·¥ä½œ
2. **å‰ç«¯ API æœåŠ¡**ï¼š`stats-api.ts` ä¸­å·²å®šä¹‰æ‰€æœ‰ API è°ƒç”¨æ–¹æ³•
3. **ç±»å‹å®šä¹‰**ï¼šæ‰€æœ‰æ•°æ®ç±»å‹å·²åœ¨ `stats-api.ts` ä¸­å®šä¹‰
4. **é¡µé¢ç»„ä»¶**ï¼š5ä¸ªé¡µé¢ç»„ä»¶å·²å…¨éƒ¨åˆ›å»º
5. **è·¯ç”±é…ç½®**ï¼šè·¯ç”±å·²è‡ªåŠ¨ç”Ÿæˆå¹¶æ³¨å†Œ

### âŒ éœ€è¦å®Œæˆçš„éƒ¨åˆ†

1. **ä¸»æ•°æ®æŸ¥è¯¢é¡µé¢**ï¼š`/data-query` é¡µé¢éœ€è¦é‡æ„
   - å½“å‰æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æŸ¥è¯¢é¡µé¢
   - éœ€è¦æ”¹ä¸ºå¸¦ä¾§è¾¹æ å¯¼èˆªçš„å¸ƒå±€é¡µé¢

2. **ä¾§è¾¹æ å¯¼èˆª**ï¼šéœ€è¦æ·»åŠ 5ä¸ªèœå•é¡¹
   - ç¼ºå‹¤å†å²æ˜ç»†è¡¨
   - è¯¾ç¨‹å†å²ç»Ÿè®¡è¡¨
   - å­¦ç”Ÿå†å²ç»Ÿè®¡è¡¨
   - å­¦ç”Ÿå†å²ç»Ÿè®¡è¯¦æƒ…è¡¨
   - æ•™å­¦ç­è¡¨

3. **é¡µé¢å¸ƒå±€**ï¼šéœ€è¦ç»Ÿä¸€5ä¸ªå­é¡µé¢çš„å¸ƒå±€
   - å·¦ä¾§ï¼šä¾§è¾¹æ å¯¼èˆª
   - å³ä¾§ï¼šå†…å®¹åŒºåŸŸ

---

## ğŸ› ï¸ é‡æ„æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šä¿®æ”¹ä¸»é¡µé¢ä¸ºå¸ƒå±€é¡µé¢ï¼ˆæ¨èï¼‰

**ä¼˜ç‚¹**ï¼š
- ç¬¦åˆ TanStack Router çš„åµŒå¥—è·¯ç”±æ¨¡å¼
- ä»£ç ç»“æ„æ¸…æ™°
- æ˜“äºç»´æŠ¤

**å®æ–½æ­¥éª¤**ï¼š

1. **ä¿®æ”¹ `/data-query` ä¸»é¡µé¢**
   - æ–‡ä»¶ï¼š`apps/agendaedu-web/src/routes/_authenticated/data-query.tsx`
   - æ”¹ä¸ºå¸ƒå±€ç»„ä»¶ï¼ŒåŒ…å«å·¦ä¾§å¯¼èˆªå’Œå³ä¾§å†…å®¹åŒºåŸŸ
   - ä½¿ç”¨ `<Outlet />` æ¸²æŸ“å­è·¯ç”±

2. **åˆ›å»ºä¾§è¾¹æ å¯¼èˆªç»„ä»¶**
   - æ–‡ä»¶ï¼š`apps/agendaedu-web/src/features/data-query/components/data-query-sidebar.tsx`
   - åŒ…å«5ä¸ªèœå•é¡¹
   - é«˜äº®å½“å‰æ¿€æ´»çš„èœå•

3. **è°ƒæ•´å­é¡µé¢å¸ƒå±€**
   - ç§»é™¤å­é¡µé¢çš„å¤–å±‚å®¹å™¨
   - åªä¿ç•™å†…å®¹åŒºåŸŸ
   - ç»Ÿä¸€æ ·å¼

4. **æ·»åŠ é»˜è®¤é‡å®šå‘**
   - è®¿é—® `/data-query` æ—¶è‡ªåŠ¨é‡å®šå‘åˆ° `/data-query/absent-history`

### æ–¹æ¡ˆ 2ï¼šä¿æŒä¸»é¡µé¢ç‹¬ç«‹ï¼Œæ·»åŠ å¯¼èˆªæ 

**ä¼˜ç‚¹**ï¼š
- æ”¹åŠ¨è¾ƒå°
- ä¿æŒç°æœ‰é¡µé¢åŠŸèƒ½

**ç¼ºç‚¹**ï¼š
- ä¸ç¬¦åˆåµŒå¥—è·¯ç”±æ¨¡å¼
- éœ€è¦åœ¨æ¯ä¸ªå­é¡µé¢æ·»åŠ å¯¼èˆª

---

## ğŸ“ æ¨èå®æ–½æ–¹æ¡ˆï¼ˆæ–¹æ¡ˆ 1ï¼‰

### æ­¥éª¤ 1ï¼šåˆ›å»ºä¾§è¾¹æ å¯¼èˆªç»„ä»¶

**æ–‡ä»¶**ï¼š`apps/agendaedu-web/src/features/data-query/components/data-query-sidebar.tsx`

```typescript
import { Link, useLocation } from '@tanstack/react-router'
import { cn } from '@/lib/utils'
import { FileText, BarChart3, Users, FileSpreadsheet, BookOpen } from 'lucide-react'

const menuItems = [
  {
    title: 'ç¼ºå‹¤å†å²æ˜ç»†è¡¨',
    url: '/data-query/absent-history',
    icon: FileText,
  },
  {
    title: 'è¯¾ç¨‹å†å²ç»Ÿè®¡è¡¨',
    url: '/data-query/course-stats',
    icon: BarChart3,
  },
  {
    title: 'å­¦ç”Ÿå†å²ç»Ÿè®¡è¡¨',
    url: '/data-query/student-stats',
    icon: Users,
  },
  {
    title: 'å­¦ç”Ÿå†å²ç»Ÿè®¡è¯¦æƒ…è¡¨',
    url: '/data-query/student-stats-details',
    icon: FileSpreadsheet,
  },
  {
    title: 'æ•™å­¦ç­è¡¨',
    url: '/data-query/teaching-class',
    icon: BookOpen,
  },
]

export function DataQuerySidebar() {
  const location = useLocation()
  
  return (
    <nav className="space-y-2">
      {menuItems.map((item) => {
        const Icon = item.icon
        const isActive = location.pathname === item.url
        
        return (
          <Link
            key={item.url}
            to={item.url}
            className={cn(
              'flex items-center gap-3 rounded-lg px-3 py-2 text-sm transition-colors',
              isActive
                ? 'bg-primary text-primary-foreground'
                : 'hover:bg-muted'
            )}
          >
            <Icon className="h-4 w-4" />
            {item.title}
          </Link>
        )
      })}
    </nav>
  )
}
```

### æ­¥éª¤ 2ï¼šä¿®æ”¹ä¸»æ•°æ®æŸ¥è¯¢é¡µé¢

**æ–‡ä»¶**ï¼š`apps/agendaedu-web/src/routes/_authenticated/data-query.tsx`

```typescript
import { createFileRoute, Outlet, redirect } from '@tanstack/react-router'
import { DataQuerySidebar } from '@/features/data-query/components/data-query-sidebar'

export const Route = createFileRoute('/_authenticated/data-query')({
  beforeLoad: ({ location }) => {
    // å¦‚æœè®¿é—® /data-queryï¼Œé‡å®šå‘åˆ°ç¬¬ä¸€ä¸ªå­é¡µé¢
    if (location.pathname === '/data-query') {
      throw redirect({
        to: '/data-query/absent-history',
      })
    }
  },
  component: DataQueryLayout,
})

function DataQueryLayout() {
  return (
    <div className="flex h-full">
      {/* å·¦ä¾§å¯¼èˆª */}
      <aside className="w-64 border-r bg-background p-6">
        <div className="mb-6">
          <h2 className="text-2xl font-bold">æ•°æ®æŸ¥è¯¢</h2>
          <p className="text-sm text-muted-foreground">æŸ¥çœ‹å„ç±»ç»Ÿè®¡æ•°æ®</p>
        </div>
        <DataQuerySidebar />
      </aside>
      
      {/* å³ä¾§å†…å®¹åŒºåŸŸ */}
      <main className="flex-1 overflow-auto">
        <Outlet />
      </main>
    </div>
  )
}
```

### æ­¥éª¤ 3ï¼šè°ƒæ•´å­é¡µé¢å¸ƒå±€

ç§»é™¤å­é¡µé¢çš„å¤–å±‚å®¹å™¨ï¼Œåªä¿ç•™å†…å®¹åŒºåŸŸã€‚ä¾‹å¦‚ `absent-history.tsx`ï¼š

```typescript
// ä¿®æ”¹å‰
return (
  <div className='flex-1 space-y-6 p-4 pt-6 md:p-8'>
    {/* å†…å®¹ */}
  </div>
)

// ä¿®æ”¹å
return (
  <div className='space-y-6 p-4 pt-6 md:p-8'>
    {/* å†…å®¹ */}
  </div>
)
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•æ­¥éª¤

1. **è®¿é—®ä¸»é¡µé¢**
   - URL: `http://localhost:5175/web/data-query`
   - é¢„æœŸï¼šè‡ªåŠ¨é‡å®šå‘åˆ° `/data-query/absent-history`

2. **éªŒè¯ä¾§è¾¹æ å¯¼èˆª**
   - æ£€æŸ¥5ä¸ªèœå•é¡¹æ˜¯å¦æ­£ç¡®æ˜¾ç¤º
   - ç‚¹å‡»æ¯ä¸ªèœå•é¡¹ï¼ŒéªŒè¯è·¯ç”±è·³è½¬
   - éªŒè¯å½“å‰æ¿€æ´»èœå•çš„é«˜äº®æ•ˆæœ

3. **éªŒè¯æ•°æ®åŠ è½½**
   - è®¿é—®æ¯ä¸ªå­é¡µé¢
   - éªŒè¯æ•°æ®æ˜¯å¦æ­£ç¡®åŠ è½½
   - éªŒè¯åˆ†é¡µã€æœç´¢ã€æ’åºåŠŸèƒ½

4. **éªŒè¯å“åº”å¼å¸ƒå±€**
   - æµ‹è¯•ä¸åŒå±å¹•å°ºå¯¸ä¸‹çš„æ˜¾ç¤ºæ•ˆæœ
   - éªŒè¯ç§»åŠ¨ç«¯çš„é€‚é…

---

## ğŸ“‹ éœ€è¦åˆ›å»º/ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

### éœ€è¦åˆ›å»ºçš„æ–‡ä»¶

1. `apps/agendaedu-web/src/features/data-query/components/data-query-sidebar.tsx` - ä¾§è¾¹æ å¯¼èˆªç»„ä»¶

### éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

1. `apps/agendaedu-web/src/routes/_authenticated/data-query.tsx` - ä¸»æ•°æ®æŸ¥è¯¢é¡µé¢ï¼ˆæ”¹ä¸ºå¸ƒå±€é¡µé¢ï¼‰
2. `apps/agendaedu-web/src/routes/_authenticated/data-query/absent-history.tsx` - è°ƒæ•´å¸ƒå±€
3. `apps/agendaedu-web/src/routes/_authenticated/data-query/course-stats.tsx` - è°ƒæ•´å¸ƒå±€
4. `apps/agendaedu-web/src/routes/_authenticated/data-query/student-stats.tsx` - è°ƒæ•´å¸ƒå±€
5. `apps/agendaedu-web/src/routes/_authenticated/data-query/student-stats-details.tsx` - è°ƒæ•´å¸ƒå±€
6. `apps/agendaedu-web/src/routes/_authenticated/data-query/teaching-class.tsx` - è°ƒæ•´å¸ƒå±€

---

## âœ… ç¡®è®¤æ¸…å•

- [x] åç«¯æ¥å£å·²å®ç°å¹¶æ­£å¸¸å·¥ä½œ
- [x] å‰ç«¯ API æœåŠ¡å·²å®šä¹‰
- [x] æ•°æ®ç±»å‹å·²å®šä¹‰
- [x] 5ä¸ªå­é¡µé¢ç»„ä»¶å·²åˆ›å»º
- [x] è·¯ç”±å·²é…ç½®
- [ ] ä¸»é¡µé¢éœ€è¦æ”¹ä¸ºå¸ƒå±€é¡µé¢
- [ ] éœ€è¦åˆ›å»ºä¾§è¾¹æ å¯¼èˆªç»„ä»¶
- [ ] éœ€è¦è°ƒæ•´å­é¡µé¢å¸ƒå±€
- [ ] éœ€è¦æ·»åŠ é»˜è®¤é‡å®šå‘

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

è¯·ç¡®è®¤ä»¥ä¸Šæ–¹æ¡ˆæ˜¯å¦ç¬¦åˆæ‚¨çš„éœ€æ±‚ã€‚å¦‚æœç¡®è®¤æ— è¯¯ï¼Œæˆ‘å°†å¼€å§‹å®æ–½ï¼š

1. åˆ›å»ºä¾§è¾¹æ å¯¼èˆªç»„ä»¶
2. ä¿®æ”¹ä¸»æ•°æ®æŸ¥è¯¢é¡µé¢ä¸ºå¸ƒå±€é¡µé¢
3. è°ƒæ•´5ä¸ªå­é¡µé¢çš„å¸ƒå±€
4. æµ‹è¯•éªŒè¯æ‰€æœ‰åŠŸèƒ½

è¯·å‘Šè¯‰æˆ‘æ˜¯å¦å¯ä»¥å¼€å§‹å®æ–½ï¼


