# è¯¾ç¨‹æ—¥å†åŠŸèƒ½ - åˆ†äº«äººåˆ—è¡¨æ·»åŠ å·²æœ‰æƒé™æ•°æ˜¾ç¤º

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

åœ¨åˆ†äº«äººåˆ—è¡¨é¡µé¢çš„æ•™å­¦ç­å­¦ç”Ÿæ€»æ•°æ˜¾ç¤ºåŒºåŸŸï¼Œå¢åŠ å·²æœ‰æƒé™æ•°çš„æ˜¾ç¤ºï¼Œæ–¹ä¾¿ç”¨æˆ·åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡ŒåŒæ­¥æ“ä½œã€‚

---

## âœ… å®Œæˆçš„åŠŸèƒ½

### åŠŸèƒ½æè¿°

**ä¿®æ”¹å‰**ï¼š
- åªæ˜¾ç¤º"æ•™å­¦ç­å­¦ç”Ÿæ€»æ•°ï¼šxxx äºº"
- ç”¨æˆ·æ— æ³•ç›´è§‚åˆ¤æ–­æœ‰å¤šå°‘å­¦ç”Ÿå·²ç»æ‹¥æœ‰æƒé™
- ä¸æ¸…æ¥šæ˜¯å¦éœ€è¦è¿›è¡ŒåŒæ­¥æ“ä½œ

**ä¿®æ”¹å**ï¼š
- åŒæ—¶æ˜¾ç¤º"æ•™å­¦ç­å­¦ç”Ÿæ€»æ•°"å’Œ"å·²æœ‰æƒé™æ•°"
- ä¸¤ä¸ªæ•°æ®å¹¶æ’æ˜¾ç¤ºï¼Œä¾¿äºå¯¹æ¯”
- ç”¨æˆ·å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼š
  - æ•™å­¦ç­æ€»å…±æœ‰å¤šå°‘å­¦ç”Ÿ
  - å·²ç»æœ‰å¤šå°‘å­¦ç”Ÿæ‹¥æœ‰æ—¥å†æƒé™
  - é€šè¿‡å¯¹æ¯”ä¸¤ä¸ªæ•°å­—ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦ç‚¹å‡»"åŒæ­¥"æŒ‰é’®

---

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. åç«¯ä¿®æ”¹

#### 1.1 æ¥å£å®šä¹‰

**æ–‡ä»¶**ï¼š`apps/app-icalink/src/services/interfaces/ICourseCalendarService.ts`

**ä¿®æ”¹æ¥å£**ï¼š
```typescript
// ä¿®æ”¹å‰
export interface CalendarParticipantsResponse {
  participants: CalendarParticipant[];
  totalStudents: number;
}

// ä¿®æ”¹å
export interface CalendarParticipantsResponse {
  participants: CalendarParticipant[];
  totalStudents: number;
  existingPermissions: number;  // æ–°å¢ï¼šå·²æœ‰æƒé™æ•°
}
```

#### 1.2 Serviceå®ç°

**æ–‡ä»¶**ï¼š`apps/app-icalink/src/services/CourseCalendarService.ts`

**ä¿®æ”¹è¿”å›å€¼**ï¼š
```typescript
// ä¿®æ”¹å‰
return {
  success: true,
  data: {
    participants: validParticipants,
    totalStudents: teachingClassRecords.length
  }
};

// ä¿®æ”¹å
return {
  success: true,
  data: {
    participants: validParticipants,
    totalStudents: teachingClassRecords.length,
    existingPermissions: validParticipants.length  // æ–°å¢ï¼šå·²æœ‰æƒé™æ•°
  }
};
```

**æ•°æ®è¯´æ˜**ï¼š
- `totalStudents`: ä» `icalink_teaching_class` è¡¨æŸ¥è¯¢çš„æ‰€æœ‰å­¦ç”Ÿæ•°é‡
- `existingPermissions`: æœ‰æ•ˆçš„å‚ä¸è€…æ•°é‡ï¼ˆå³å·²ç»æ‹¥æœ‰æ—¥å†æƒé™çš„å­¦ç”Ÿæ•°é‡ï¼‰
- `validParticipants`: åœ¨æ•™å­¦ç­è¡¨ä¸­èƒ½åŒ¹é…åˆ°çš„æœ‰æ•ˆæƒé™åˆ—è¡¨

---

### 2. å‰ç«¯ä¿®æ”¹

#### 2.1 ç±»å‹å®šä¹‰

**æ–‡ä»¶**ï¼š`apps/agendaedu-web/src/types/course-calendar.types.ts`

**ä¿®æ”¹ç±»å‹**ï¼š
```typescript
// ä¿®æ”¹å‰
export interface CalendarParticipantsResponse {
  participants: CalendarParticipant[]
  totalStudents: number
}

// ä¿®æ”¹å
export interface CalendarParticipantsResponse {
  participants: CalendarParticipant[]
  totalStudents: number
  existingPermissions: number  // æ–°å¢ï¼šå·²æœ‰æƒé™æ•°
}
```

#### 2.2 é¡µé¢ç»„ä»¶

**æ–‡ä»¶**ï¼š`apps/agendaedu-web/src/routes/_authenticated/course-calendar/index.tsx`

**æ•°æ®æå–**ï¼š
```typescript
// ä¿®æ”¹å‰
const shareParticipants = shareParticipantsData?.participants || []
const totalStudents = shareParticipantsData?.totalStudents || 0

// ä¿®æ”¹å
const shareParticipants = shareParticipantsData?.participants || []
const totalStudents = shareParticipantsData?.totalStudents || 0
const existingPermissions = shareParticipantsData?.existingPermissions || 0  // æ–°å¢
```

**UIç»„ä»¶**ï¼š
```tsx
{/* ä¿®æ”¹å‰ */}
<div className='text-muted-foreground flex items-center gap-2 text-sm'>
  <span className='font-medium'>æ•™å­¦ç­å­¦ç”Ÿæ€»æ•°ï¼š</span>
  <span className='text-foreground font-semibold'>
    {totalStudents} äºº
  </span>
</div>

{/* ä¿®æ”¹å */}
<div className='text-muted-foreground flex items-center gap-6 text-sm'>
  <div className='flex items-center gap-2'>
    <span className='font-medium'>æ•™å­¦ç­å­¦ç”Ÿæ€»æ•°ï¼š</span>
    <span className='text-foreground font-semibold'>
      {totalStudents} äºº
    </span>
  </div>
  <div className='flex items-center gap-2'>
    <span className='font-medium'>å·²æœ‰æƒé™æ•°ï¼š</span>
    <span className='text-foreground font-semibold'>
      {existingPermissions} äºº
    </span>
  </div>
</div>
```

---

## ğŸ¨ UIæ•ˆæœå¯¹æ¯”

### ä¿®æ”¹å‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•™å­¦ç­å­¦ç”Ÿæ€»æ•°ï¼š120 äºº                                 â”‚
â”‚  [ğŸ” æœç´¢: è¾“å…¥å­¦ç”Ÿå§“åæˆ–å­¦å·...]  [ğŸ”µ åŒæ­¥]          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç”¨æˆ·ID  â”‚ å­¦ç”Ÿå§“å â”‚ å­¦é™¢ â”‚ ä¸“ä¸š â”‚ ç­çº§ â”‚ æƒé™è§’è‰²    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¿®æ”¹å

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•™å­¦ç­å­¦ç”Ÿæ€»æ•°ï¼š120 äºº  |  å·²æœ‰æƒé™æ•°ï¼š105 äºº         â”‚
â”‚  [ğŸ” æœç´¢: è¾“å…¥å­¦ç”Ÿå§“åæˆ–å­¦å·...]  [ğŸ”µ åŒæ­¥]          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç”¨æˆ·ID  â”‚ å­¦ç”Ÿå§“å â”‚ å­¦é™¢ â”‚ ä¸“ä¸š â”‚ ç­çº§ â”‚ æƒé™è§’è‰²    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ”¹è¿›ç‚¹**ï¼š
- âœ… æ–°å¢å·²æœ‰æƒé™æ•°æ˜¾ç¤º
- âœ… ä¸¤ä¸ªæ•°æ®å¹¶æ’æ˜¾ç¤ºï¼Œä¾¿äºå¯¹æ¯”
- âœ… ç”¨æˆ·å¯ä»¥ç›´è§‚åˆ¤æ–­æ˜¯å¦éœ€è¦åŒæ­¥ï¼ˆ120 - 105 = 15 ä¸ªå­¦ç”Ÿéœ€è¦åŒæ­¥ï¼‰

---

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½é¡¹ | ä¿®æ”¹å‰ | ä¿®æ”¹å | æ”¹è¿› |
|--------|--------|--------|------|
| æ•™å­¦ç­æ€»æ•°æ˜¾ç¤º | âœ… æ˜¾ç¤º | âœ… æ˜¾ç¤º | - |
| å·²æœ‰æƒé™æ•°æ˜¾ç¤º | âŒ æ—  | âœ… æ˜¾ç¤º | â¬†ï¸ æ–°å¢ |
| æ•°æ®å¯¹æ¯” | âŒ æ— æ³•å¯¹æ¯” | âœ… å¹¶æ’æ˜¾ç¤ºï¼Œä¾¿äºå¯¹æ¯” | â¬†ï¸ æ˜¾è‘—æå‡ |
| åŒæ­¥åˆ¤æ–­ | âŒ ä¸æ¸…æ¥šæ˜¯å¦éœ€è¦åŒæ­¥ | âœ… å¯ä»¥ç›´è§‚åˆ¤æ–­ | â¬†ï¸ æ˜¾è‘—æå‡ |

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### åç«¯æ–‡ä»¶ï¼ˆ2ä¸ªï¼‰

1. **`apps/app-icalink/src/services/interfaces/ICourseCalendarService.ts`**
   - ä¿®æ”¹ `CalendarParticipantsResponse` æ¥å£ï¼Œæ–°å¢ `existingPermissions` å­—æ®µ

2. **`apps/app-icalink/src/services/CourseCalendarService.ts`**
   - ä¿®æ”¹ `getCalendarParticipants` æ–¹æ³•è¿”å›å€¼ï¼Œæ·»åŠ  `existingPermissions: validParticipants.length`

### å‰ç«¯æ–‡ä»¶ï¼ˆ2ä¸ªï¼‰

1. **`apps/agendaedu-web/src/types/course-calendar.types.ts`**
   - ä¿®æ”¹ `CalendarParticipantsResponse` ç±»å‹å®šä¹‰ï¼Œæ–°å¢ `existingPermissions` å­—æ®µ

2. **`apps/agendaedu-web/src/routes/_authenticated/course-calendar/index.tsx`**
   - æå– `existingPermissions` æ•°æ®
   - ä¿®æ”¹UIï¼Œå¹¶æ’æ˜¾ç¤ºæ•™å­¦ç­æ€»æ•°å’Œå·²æœ‰æƒé™æ•°

---

## ğŸ¯ ç”¨æˆ·ä½“éªŒæ”¹è¿›

### ä¿®æ”¹å‰çš„é—®é¢˜

1. **ä¿¡æ¯ä¸å®Œæ•´**ï¼š
   - âŒ åªçŸ¥é“æ•™å­¦ç­æœ‰å¤šå°‘å­¦ç”Ÿ
   - âŒ ä¸çŸ¥é“æœ‰å¤šå°‘å­¦ç”Ÿå·²ç»æœ‰æƒé™
   - âŒ æ— æ³•åˆ¤æ–­æ˜¯å¦éœ€è¦åŒæ­¥

2. **æ“ä½œä¸æ˜ç¡®**ï¼š
   - âŒ ä¸æ¸…æ¥šç‚¹å‡»"åŒæ­¥"æŒ‰é’®ä¼šæ·»åŠ å¤šå°‘å­¦ç”Ÿ
   - âŒ å¯èƒ½ä¼šé‡å¤åŒæ­¥ï¼ˆæµªè´¹æ—¶é—´ï¼‰

### ä¿®æ”¹åçš„æ”¹è¿›

1. **ä¿¡æ¯å®Œæ•´**ï¼š
   - âœ… æ¸…æ¥šæ˜¾ç¤ºæ•™å­¦ç­æ€»å­¦ç”Ÿæ•°
   - âœ… æ¸…æ¥šæ˜¾ç¤ºå·²æœ‰æƒé™çš„å­¦ç”Ÿæ•°
   - âœ… å¯ä»¥è®¡ç®—å‡ºéœ€è¦åŒæ­¥çš„å­¦ç”Ÿæ•°ï¼ˆæ€»æ•° - å·²æœ‰æƒé™æ•°ï¼‰

2. **æ“ä½œæ˜ç¡®**ï¼š
   - âœ… å¯ä»¥åˆ¤æ–­æ˜¯å¦éœ€è¦åŒæ­¥
   - âœ… çŸ¥é“åŒæ­¥ä¼šæ·»åŠ å¤šå°‘å­¦ç”Ÿ
   - âœ… é¿å…ä¸å¿…è¦çš„åŒæ­¥æ“ä½œ

### ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

**åœºæ™¯1ï¼šéœ€è¦åŒæ­¥**
```
æ•™å­¦ç­å­¦ç”Ÿæ€»æ•°ï¼š120 äºº  |  å·²æœ‰æƒé™æ•°ï¼š105 äºº
```
- ç”¨æˆ·åˆ¤æ–­ï¼šè¿˜æœ‰ 15 ä¸ªå­¦ç”Ÿæ²¡æœ‰æƒé™ï¼Œéœ€è¦ç‚¹å‡»"åŒæ­¥"æŒ‰é’®

**åœºæ™¯2ï¼šä¸éœ€è¦åŒæ­¥**
```
æ•™å­¦ç­å­¦ç”Ÿæ€»æ•°ï¼š120 äºº  |  å·²æœ‰æƒé™æ•°ï¼š120 äºº
```
- ç”¨æˆ·åˆ¤æ–­ï¼šæ‰€æœ‰å­¦ç”Ÿéƒ½å·²ç»æœ‰æƒé™ï¼Œä¸éœ€è¦åŒæ­¥

**åœºæ™¯3ï¼šæ–°è¯¾ç¨‹**
```
æ•™å­¦ç­å­¦ç”Ÿæ€»æ•°ï¼š120 äºº  |  å·²æœ‰æƒé™æ•°ï¼š0 äºº
```
- ç”¨æˆ·åˆ¤æ–­ï¼šè¿™æ˜¯æ–°è¯¾ç¨‹ï¼Œéœ€è¦ç‚¹å‡»"åŒæ­¥"æŒ‰é’®æ·»åŠ æ‰€æœ‰å­¦ç”Ÿ

---

## ğŸ“‹ æµ‹è¯•å»ºè®®

### åŠŸèƒ½æµ‹è¯•

- [ ] éªŒè¯æ•™å­¦ç­å­¦ç”Ÿæ€»æ•°æ­£ç¡®æ˜¾ç¤º
- [ ] éªŒè¯å·²æœ‰æƒé™æ•°æ­£ç¡®æ˜¾ç¤º
- [ ] éªŒè¯ä¸¤ä¸ªæ•°æ®å¹¶æ’æ˜¾ç¤ºï¼Œå¸ƒå±€ç¾è§‚
- [ ] éªŒè¯æ•°æ®ä¸å®é™…æƒ…å†µä¸€è‡´

### æ•°æ®éªŒè¯

- [ ] æ•™å­¦ç­æ€»æ•° = `icalink_teaching_class` è¡¨ä¸­çš„å­¦ç”Ÿæ•°é‡
- [ ] å·²æœ‰æƒé™æ•° = æœ‰æ•ˆçš„å‚ä¸è€…æ•°é‡ï¼ˆåœ¨æ•™å­¦ç­è¡¨ä¸­èƒ½åŒ¹é…åˆ°çš„æƒé™ï¼‰
- [ ] éœ€è¦åŒæ­¥çš„å­¦ç”Ÿæ•° = æ•™å­¦ç­æ€»æ•° - å·²æœ‰æƒé™æ•°

### è¾¹ç•Œæƒ…å†µæµ‹è¯•

- [ ] æ•™å­¦ç­æ— å­¦ç”Ÿæ—¶ï¼Œæ˜¾ç¤º"0 äºº | 0 äºº"
- [ ] æ‰€æœ‰å­¦ç”Ÿéƒ½æœ‰æƒé™æ—¶ï¼Œæ˜¾ç¤º"xxx äºº | xxx äºº"ï¼ˆä¸¤ä¸ªæ•°å­—ç›¸åŒï¼‰
- [ ] æ²¡æœ‰å­¦ç”Ÿæœ‰æƒé™æ—¶ï¼Œæ˜¾ç¤º"xxx äºº | 0 äºº"
- [ ] åŒæ­¥åï¼Œå·²æœ‰æƒé™æ•°è‡ªåŠ¨æ›´æ–°

### UIæµ‹è¯•

- [ ] ä¸¤ä¸ªæ•°æ®ä¹‹é—´çš„é—´è·åˆé€‚ï¼ˆ`gap-6`ï¼‰
- [ ] å­—ä½“æ ·å¼ä¸€è‡´ï¼ˆç²—ä½“ã€é¢œè‰²ï¼‰
- [ ] å“åº”å¼å¸ƒå±€æ­£å¸¸ï¼ˆå°å±å¹•ä¸æ¢è¡Œï¼‰

---

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡æ›´æ–°ä¸ºåˆ†äº«äººåˆ—è¡¨é¡µé¢æ·»åŠ äº†å·²æœ‰æƒé™æ•°çš„æ˜¾ç¤ºï¼Œä¸»è¦æ”¹è¿›ï¼š

1. **ä¿¡æ¯å®Œæ•´æ€§**ï¼šåŒæ—¶æ˜¾ç¤ºæ•™å­¦ç­æ€»æ•°å’Œå·²æœ‰æƒé™æ•°
2. **æ•°æ®å¯¹æ¯”**ï¼šä¸¤ä¸ªæ•°æ®å¹¶æ’æ˜¾ç¤ºï¼Œä¾¿äºå¯¹æ¯”
3. **æ“ä½œå¼•å¯¼**ï¼šç”¨æˆ·å¯ä»¥ç›´è§‚åˆ¤æ–­æ˜¯å¦éœ€è¦åŒæ­¥
4. **ç”¨æˆ·ä½“éªŒ**ï¼šæä¾›æ›´å®Œæ•´çš„ä¿¡æ¯ï¼Œé¿å…ä¸å¿…è¦çš„æ“ä½œ

è¿™ä¸ªæ”¹è¿›æ˜¾è‘—æå‡äº†ç”¨æˆ·ä½“éªŒï¼Œä½¿é¡µé¢æ›´åŠ å®ç”¨å’Œå‹å¥½ï¼

