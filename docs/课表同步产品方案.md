# 课表同步应用产品需求文档

## 1. 产品概述

### 1.1 产品定位
一个连接教育机构课表系统与WPS协作空间的智能同步工具，将课表数据智能转换为WPS协作应用中的各类应用数据，实现教学管理数字化转型。

### 1.2 目标用户
- 教师：需要管理课程和查看课表的教师
- 学生：需要了解课程安排的学生
- 教务管理人员：负责课程统筹和管理的工作人员

## 2. 系统架构

### 2.1 核心模块
1. 数据采集模块
   - 课表数据读取
   - 数据格式标准化处理
   - 数据验证与清洗

2. 数据转换模块
   - 课表到日程的转换器
   - 课表到打卡的转换器
   - 课表到审批流的转换器

3. WPS协作空间集成模块
   - 日程/日历管理
   - 审批流程管理
   - 打卡管理

4. 同步管理模块
   - 同步策略配置
   - 同步状态监控
   - 错误处理机制

### 2.2 数据模型

根据提供的表结构，主要涉及：

1. 课程安排表(kcb)
```
- kkh: 开课号（主键）
- xnxq: 学年学期
- jxz: 教学周
- zc: 周次
- jc: 节次
- kcmc: 课程名称
- ghs: 教师工号组
- xms: 教师姓名组
```

2. 学生课表(xs_kb)
```
- kkh: 开课号（外键）
- xh: 学生学号
- xnxq: 学年学期
- kcbh: 课程编号
```

3. 考勤数据模型
```
- xh: 学生学号
- kkh: 开课号
- kcrq: 课程日期
- kcjc: 课程节次
- dkzt: 打卡状态 (0-未打卡, 1-已打卡)
- dksj: 打卡时间
- dkwz: 打卡位置
- sfyx: 是否有效
```

4. 请假数据模型
```
- xh: 学生学号
- kkh: 开课号
- qjlx: 请假类型
- qjkssj: 请假开始时间
- qjjssj: 请假结束时间
- qjyy: 请假原因
- spzt: 审批状态 (0-待审批, 1-已批准, 2-已拒绝)
- splsj: 审批历史记录
```

## 3. 功能模块详细设计

### 3.1 日程/日历同步功能

#### 用户故事
- 作为教师，我希望课表自动同步到WPS日历，以便随时查看我的授课安排
- 作为学生，我希望可以在WPS日历中直观地看到我的课程安排
- 作为教务人员，我希望能批量创建和管理课程日历

#### 功能规格
1. 日历创建
   - 按学期自动创建课程日历
   - 支持按教师/班级/课程分类创建子日历
   - 设置合适的日历查看权限

2. 日程同步
   - 将课表转换为标准日程格式
   - 自动设置重复规则（如每周固定时间）
   - 包含课程详细信息（教室、教师等）

### 3.2 考勤打卡功能

#### 用户故事
- 作为教师，我希望能便捷地完成课程考勤
- 作为学生，我希望能方便地进行课程签到
- 作为教务人员，我希望能实时掌握考勤数据

#### 功能规格
1. 打卡表单生成
   - 根据课表自动生成打卡任务
   - 设置打卡时间范围（课前10分钟到课后10分钟）
   - 支持位置打卡和普通打卡

2. 考勤统计
   - 实时统计打卡情况
   - 生成考勤报表
   - 异常考勤提醒

### 3.3 审批流程功能

#### 用户故事
- 作为学生，我希望能方便地提交请假申请
- 作为教师，我希望能及时处理学生的请假申请
- 作为教务人员，我希望能统一管理所有课程相关的审批流程

#### 功能规格
1. 审批模板配置
   - 请假审批流程模板

2. 审批流程管理
   - 自动关联课程信息
   - 多级审批流转
   - 审批结果通知

### 3.4 前端交互流程

#### 1. 学生日历查看与打卡流程
- 学生登录WPS协作空间后，首页显示当日课程日历视图
- 在日程视图中，即将开始的课程会显示"打卡"超链接
- 用户打开打卡详情页，可以看到打开和请求两个选项
- 课程详情页面同时展示考勤状态和请假选项

#### 2. 学生请假申请流程
- 学生在日历课程详情页点击"请假"按钮
- 填写请假表单，选择请假类型（病假、事假等）、时间段和请假原因
- 提交后，表单通过WPS审批流程流转至相关教师
- 请假获批后，学生可以在wps协作的请审批中看到审批结果

#### 3. 教师打卡管理与请假审批流程
- 教师可以在wps协作中看到待处理审批
- 课前自动提醒上课打卡
- 教师收到请假申请后，可在审批流程中查看详情并进行审批
- 在后台管理查看学生考勤情况，包括：
  - 已打卡学生列表
  - 已请假学生列表
  - 未打卡且未请假学生列表（异常名单）
- 教师可手动修改学生考勤状态
- 审批意见通过wps协作自动通知到相关学生

#### 4. 教务人员数据分析流程
- 教务人员登录后，可查看全校打卡信息
- 提供考勤数据分析面板，包括：
  - 课程出勤率统计
  - 缺勤学生分布情况
  - 异常学生（既不打卡也未请假）识别名单
- 支持按班级、课程、时间段等多维度筛选和导出数据
- 提供考勤异常预警功能，自动标记出现频繁缺勤的课程和学生

## 4. 技术实现建议

### 4.1 系统集成方案
1. 数据同步策略
   - 采用增量同步机制
   - 设置合理的同步频率
   - 实现失败重试机制

2. API调用设计
   - 实现API请求队列
   - 设置请求频率限制
   - 处理API调用异常

### 4.2 数据转换规则
1. 课表到日历转换
```json
{
  "title": "${kcmc}",
  "start_time": "根据jc转换的时间",
  "end_time": "根据jc转换的时间",
  "location": "${room}",
  "description": "教师：${xms}\n教室：${room}\n周次：${zc}",
  "repeat_rule": "每周${zc}"
}
```

2. 课表到打卡转换
```json
{
  "punch_name": "${kcmc}上课打卡",
  "valid_time": ["课前10分钟", "课后10分钟"],
  "location_required": true,
  "members": ["根据xh转换的学生列表"]
}
```

3. 考勤状态集成规则
```json
{
  "student_id": "${xh}",
  "course_id": "${kkh}",
  "date": "${kcrq}",
  "status": "已打卡|已请假|未到|缺勤",
  "punch_time": "${dksj}",
  "leave_info": {
    "type": "${qjlx}",
    "approval_status": "${spzt}"
  }
}
```

### 4.3 异常用户识别算法

识别"既不打卡也未请假"的异常用户通过以下逻辑实现：

1. 数据匹配流程
```
对于每个课程日期和节次：
  获取该课程的所有学生名单
  获取该课程时段的所有打卡记录
  获取该课程时段有效的请假记录
  计算：未打卡且未请假学生 = 所有学生 - 已打卡学生 - 已请假学生
```

2. 异常评分机制
```
为每个学生建立异常评分：
  基础分值 = 0
  每次既不打卡也未请假：+1分
  连续多次异常：额外加权 (+0.5*连续次数)
  异常率 = 异常次数/应出勤总次数
```

3. 预警级别设置
```
低风险：异常评分 1-3 或 异常率 < 20%
中风险：异常评分 4-7 或 异常率 20%-40% 
高风险：异常评分 > 7 或 异常率 > 40%
```

## 5. 后台界面与交互设计
1. 课程管理页
   - 课程基本信息
   - 学生名单与考勤情况
   - 学生分组展示：已打卡、已请假、异常缺勤
   - 手动修改考勤状态功能
   - 批量操作功能
   - 数据导出功能

2. 考勤分析页
   - 出勤率趋势图
   - 学生考勤排名
   - 异常情况分析
   - 打卡时间分布图

3. 同步管理页面
   - 同步设置
   - 同步任务查看

## 6. 数据流转与业务流程

### 6.1 打卡与请假数据流转

1. 数据生成
   - 系统基于课表自动生成打卡任务
   - 学生提交请假申请生成请假记录
   - 教师审批请假申请更新请假状态

2. 数据整合
   - 实时整合打卡数据和请假数据
   - 生成综合考勤状态（正常、请假、缺勤）
   - 定期同步到课程考勤统计表

3. 数据应用
   - 向教师推送班级考勤分析
   - 向教务人员提供全校出勤数据报表
   - 对异常学生触发预警通知

### 6.2 异常用户处理流程

1. 异常识别
   - 系统在每节课后自动识别未打卡且未请假的学生
   - 根据异常频率和模式对学生进行风险评级
   - 生成异常学生名单并按风险等级排序

2. 干预措施
   - 低风险：系统自动提醒学生注意出勤
   - 中风险：通知班主任和相关教师关注
   - 高风险：触发干预流程，安排辅导员约谈

3. 跟踪改善
   - 记录干预措施执行情况
   - 持续监控学生后续出勤情况
   - 评估干预效果并调整策略

## 7. 注意事项与风险控制

1. 数据一致性
   - 确保源数据变更能及时同步
   - 处理数据冲突情况
   - 保留数据同步日志

2. 性能考虑
   - 大批量数据同步的性能优化
   - API调用频率限制处理
   - 合理的缓存策略

3. 异常处理
   - 网络异常重试机制
   - 数据格式错误处理
   - 同步失败告警机制

4. 隐私保护
   - 学生考勤数据访问权限控制
   - 敏感信息脱敏处理
   - 合规的数据保留策略

## 8. 后续优化建议

1. 功能扩展
   - 支持更多课表数据源接入
   - 增加自定义同步规则
   - 开发移动端快捷操作

2. 用户体验优化
   - 提供同步进度可视化
   - 增加批量操作功能
   - 优化错误提示信息

3. 运维支持
   - 完善监控指标
   - 优化日志记录
   - 提供运维管理界面

4. 智能分析
   - 引入机器学习预测缺勤风险
   - 智能识别考勤异常模式
   - 个性化干预措施推荐

## 9. 项目任务分解与工作量估算

### 9.1 任务分解

#### 阶段一：需求分析与系统设计（3个工作日）
1. 界面原型设计（2天）
   - 设计教务端界面原型

2. 项目计划制定（1天）
   - 制定开发计划和里程碑
   - 风险评估
   - 资源分配

#### 阶段二：基础功能开发（12个工作日）
1. 开发环境搭建（2天）
   - 开发环境配置
   - 测试环境配置
   - CI/CD流程搭建

2. 数据同步模块开发（2天）
   - 课表数据读取接口开发
   - 数据清洗与转换逻辑实现
   - 增量同步机制开发
   - 数据同步监控开发

3. WPS日历集成开发（1天）
   - 日历创建API对接
   - 日程同步功能开发
   - 日历权限管理开发
   - 日历操作异常处理

4. 打卡功能开发（2天）
   - 打卡表单生成逻辑开发
   - 打卡记录存储功能开发
   - 打卡状态管理开发
   - 位置打卡功能开发

5. 请假审批功能开发（5天）
   - 请假表单开发
   - 审批流程对接
   - 审批状态管理开发
   - 通知推送功能开发

#### 阶段三：高级功能开发（16个工作日）
1. 考勤数据分析功能开发（8天）
   - 考勤统计算法开发
   - 异常用户识别算法开发
   - 数据可视化开发
   - 数据导出功能开发

2. 前端界面开发（5天）
   - 教务端界面开发
   - 响应式布局适配

3. 系统集成与优化（3天）
   - 模块集成
   - 性能优化
   - 兼容性测试与调整

#### 阶段四：测试与部署（10个工作日）
1. 功能测试（5天）
   - 单元测试
   - 集成测试
   - 功能测试
   - 回归测试

2. 用户体验测试（2天）
   - 用户界面测试
   - 用户流程测试
   - 收集反馈并调整

3. 系统部署与上线（3天）
   - 生产环境配置
   - 系统部署
   - 数据迁移
   - 上线监控
4. 项目总结与文档编写（2天）
   - 项目总结
   - 需求文档编写
   - 技术文档编写

### 9.2 工作量估算
| 任务 | 预计工作量（人天） | 实际工作量（人天） |
| ---- | ------------------- | ------------------- |
| 需求分析与系统设计 | 3 | 3 |
| 基础功能开发 | 12 | 12 |
| 高级功能开发 | 16 | 16 |
| 测试与部署 | 10 | 10 |
| 总计 | 41 | 41 |


## 10. 项目风险与应对策略

### 10.1 技术风险
1. **WPS API兼容性风险**
   - 风险描述：WPS协作空间API可能存在兼容性问题或限制
   - 应对策略：项目初期进行API验证测试，与WPS团队建立技术沟通渠道

2. **数据同步效率风险**
   - 风险描述：大量数据同步可能导致性能问题
   - 应对策略：设计增量同步机制，实施分批处理策略，优化数据库索引

3. **系统扩展性风险**
   - 风险描述：用户规模扩大后系统可能面临性能瓶颈
   - 应对策略：采用微服务架构，实施水平扩展策略，做好性能测试

### 10.2 项目管理风险
1. **需求变更风险**
   - 风险描述：项目过程中可能出现需求变更
   - 应对策略：建立需求变更流程，合理评估变更影响，适当调整项目周期和预算

2. **进度延误风险**
   - 风险描述：开发过程中可能出现进度延误
   - 应对策略：制定详细的项目计划，设置缓冲时间，定期进行进度审核

3. **人员变动风险**
   - 风险描述：核心团队成员可能发生变动
   - 应对策略：建立完善的知识共享机制，确保开发文档完整，适当安排人员冗余

### 10.3 业务风险
1. **用户接受度风险**
   - 风险描述：系统上线后用户可能存在适应困难
   - 应对策略：提供详细的用户培训，设计简单直观的界面，收集用户反馈并迭代优化

2. **业务流程适应风险**
   - 风险描述：系统可能与现有业务流程存在不匹配
   - 应对策略：前期充分调研现有业务流程，与相关部门充分沟通，灵活调整系统设计

3. **数据安全风险**
   - 风险描述：学生考勤和课表数据存在隐私泄露风险
   - 应对策略：实施严格的数据加密和访问控制，建立数据安全审计机制 