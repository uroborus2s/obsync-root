# WPS 云盘前端路径上传功能使用指南

## 📋 功能概述

本文档说明如何在前端页面使用新增的 `parent_path` 参数上传文件到指定路径。

---

## 🎯 功能位置

### 访问路径

1. 登录系统
2. 进入 WPS 云盘管理页面
3. 在左侧树形结构中选择一个驱动盘或文件夹
4. 点击右上角的 **"上传文件"** 按钮

---

## 🖼️ UI 界面说明

### 上传对话框

上传对话框包含以下字段：

1. **选择文件 \*** （必填）
   - 类型：文件选择器
   - 支持多文件选择
   - 显示已选择的文件数量

2. **父文件夹路径** （可选）
   - 类型：文本输入框
   - 占位符：`例如：/2024/photos 或 folder1/folder2`
   - 帮助文本：`留空表示上传到当前选中的位置。使用 / 分隔路径层级，如果路径不存在会自动创建。`

3. **上传进度** （上传时显示）
   - 显示当前上传进度百分比
   - 进度条可视化

---

## 📝 使用示例

### 示例1: 上传到当前位置（不使用路径）

**步骤**：
1. 选择驱动盘或文件夹
2. 点击 "上传文件" 按钮
3. 选择文件
4. **留空** "父文件夹路径" 字段
5. 点击 "开始上传"

**结果**：
- ✅ 文件上传到当前选中的位置
- ✅ 如果选中的是驱动盘，上传到根目录
- ✅ 如果选中的是文件夹，上传到该文件夹

---

### 示例2: 上传到单层路径

**步骤**：
1. 选择驱动盘
2. 点击 "上传文件" 按钮
3. 选择文件
4. 在 "父文件夹路径" 中输入：`/documents`
5. 点击 "开始上传"

**结果**：
- ✅ 文件上传到驱动盘根目录下的 `documents` 文件夹
- ✅ 如果 `documents` 文件夹不存在，自动创建

---

### 示例3: 上传到多层路径

**步骤**：
1. 选择驱动盘
2. 点击 "上传文件" 按钮
3. 选择文件
4. 在 "父文件夹路径" 中输入：`/2024/photos/vacation`
5. 点击 "开始上传"

**结果**：
- ✅ 文件上传到 `/2024/photos/vacation` 路径
- ✅ 如果路径不存在，自动创建所有层级
- ✅ 最终路径：`驱动盘根目录/2024/photos/vacation/文件名`

---

### 示例4: 路径格式灵活性

以下路径格式都是有效的：

| 输入路径 | 说明 | 结果 |
|---------|------|------|
| `/folder1/folder2` | 标准格式（推荐） | ✅ 正常工作 |
| `folder1/folder2` | 无开头斜杠 | ✅ 自动处理 |
| `/folder1//folder2/` | 多余斜杠 | ✅ 自动过滤 |
| `2024/photos` | 无开头斜杠 | ✅ 自动处理 |

---

## 🎯 路径规则

### 1. 路径格式

- **分隔符**：使用 `/` 分隔文件夹名称
- **开头斜杠**：可选（有无都可以）
- **结尾斜杠**：可选（会自动过滤）
- **多余斜杠**：会自动过滤

### 2. 路径解析

**输入**：`/2024/photos/vacation`

**解析为**：
```
['2024', 'photos', 'vacation']
```

**最终路径**：
```
当前选中位置/2024/photos/vacation/文件名
```

### 3. 自动创建

如果路径不存在，WPS API 会自动创建所有层级的文件夹。

**示例**：
- 输入路径：`/2024/photos/vacation`
- 如果 `2024` 不存在，创建 `2024` 文件夹
- 如果 `photos` 不存在，创建 `2024/photos` 文件夹
- 如果 `vacation` 不存在，创建 `2024/photos/vacation` 文件夹
- 最后上传文件到 `2024/photos/vacation/`

---

## 🔍 实际操作演示

### 场景1: 上传照片到年份文件夹

**需求**：将照片上传到 `/2024/photos` 路径

**操作**：
1. 选择驱动盘 "我的云盘"
2. 点击 "上传文件"
3. 选择照片文件（如 `beach.jpg`）
4. 在 "父文件夹路径" 中输入：`/2024/photos`
5. 点击 "开始上传"

**结果**：
```
我的云盘/
  └── 2024/
      └── photos/
          └── beach.jpg  ← 上传的文件
```

---

### 场景2: 上传文档到项目文件夹

**需求**：将文档上传到 `/projects/website/docs` 路径

**操作**：
1. 选择驱动盘 "团队云盘"
2. 点击 "上传文件"
3. 选择文档文件（如 `README.md`）
4. 在 "父文件夹路径" 中输入：`/projects/website/docs`
5. 点击 "开始上传"

**结果**：
```
团队云盘/
  └── projects/
      └── website/
          └── docs/
              └── README.md  ← 上传的文件
```

---

### 场景3: 批量上传到同一路径

**需求**：将多个文件上传到 `/2024/reports` 路径

**操作**：
1. 选择驱动盘
2. 点击 "上传文件"
3. 选择多个文件（如 `report1.pdf`, `report2.pdf`, `report3.pdf`）
4. 在 "父文件夹路径" 中输入：`/2024/reports`
5. 点击 "开始上传"

**结果**：
```
驱动盘/
  └── 2024/
      └── reports/
          ├── report1.pdf  ← 上传的文件
          ├── report2.pdf  ← 上传的文件
          └── report3.pdf  ← 上传的文件
```

---

## ⚠️ 注意事项

### 1. 路径是相对于当前选中位置

- 如果选中的是 **驱动盘**，路径相对于根目录
- 如果选中的是 **文件夹**，路径相对于该文件夹

**示例**：
```
选中：驱动盘 "我的云盘"
输入路径：/2024/photos
最终路径：我的云盘/2024/photos/

选中：文件夹 "projects"
输入路径：/website/docs
最终路径：projects/website/docs/
```

### 2. 留空表示上传到当前位置

如果不输入路径，文件会上传到当前选中的位置：

- 选中驱动盘 → 上传到根目录
- 选中文件夹 → 上传到该文件夹

### 3. 路径会自动创建

不用担心路径不存在，WPS API 会自动创建所有层级的文件夹。

### 4. 上传后自动共享

文件上传成功后，会自动开启共享并返回共享链接。

---

## 🧪 测试建议

### 测试1: 基本功能

- [ ] 不输入路径，上传到根目录
- [ ] 输入单层路径（如 `/documents`）
- [ ] 输入多层路径（如 `/2024/photos/vacation`）

### 测试2: 路径格式

- [ ] 有开头斜杠（`/folder1/folder2`）
- [ ] 无开头斜杠（`folder1/folder2`）
- [ ] 多余斜杠（`//folder1///folder2//`）

### 测试3: 批量上传

- [ ] 选择多个文件
- [ ] 输入路径
- [ ] 验证所有文件都上传到同一路径

### 测试4: 错误处理

- [ ] 不选择文件，点击上传（应该禁用按钮）
- [ ] 上传过程中关闭对话框（应该禁用关闭）

---

## 📊 前端日志

### 成功上传

打开浏览器控制台（F12），可以看到以下日志：

```
开始上传文件: beach.jpg 到驱动盘: q60YOE5
父目录ID: 0
父目录路径: /2024/photos
FormData 内容:
  - parent_id: 0
  - parent_path: /2024/photos
  - file: beach.jpg 123456 bytes
```

### 不使用路径

```
开始上传文件: test.txt 到驱动盘: q60YOE5
父目录ID: 0
FormData 内容:
  - parent_id: 0
  - file: test.txt 1024 bytes
```

---

## 🎉 功能优势

1. ✅ **灵活性**：可以选择使用或不使用路径
2. ✅ **自动创建**：路径不存在时自动创建
3. ✅ **格式宽松**：自动处理各种路径格式
4. ✅ **批量上传**：多个文件可以上传到同一路径
5. ✅ **用户友好**：清晰的提示和帮助文本
6. ✅ **向后兼容**：不影响现有的上传功能

---

## 📚 相关文档

- [WPS云盘路径上传功能说明](./WPS云盘路径上传功能说明.md)
- [路径上传测试示例](./路径上传测试示例.md)
- [WPS云盘文件上传与共享功能说明](./WPS云盘文件上传与共享功能说明.md)

---

**最后更新**：2025-11-05
**版本**：v1.0.0

