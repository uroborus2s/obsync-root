# è¯¾ç¨‹æ—¥å†åŠŸèƒ½å¿«é€Ÿå¯åŠ¨æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶

1. âœ… æ•°æ®åº“è¡¨å·²åˆ›å»ºï¼ˆ`icasync_calendar_mapping` å’Œ `icasync_attendance_courses`ï¼‰
2. âœ… WPS V7 API é…ç½®å·²å®Œæˆ
3. âœ… ä¾èµ–åŒ…å·²å®‰è£…

### å¯åŠ¨æ­¥éª¤

#### 1. å¯åŠ¨åç«¯æœåŠ¡

```bash
cd apps/app-icalink
pnpm run dev
```

åç«¯æœåŠ¡å°†åœ¨ `http://localhost:8090` å¯åŠ¨

#### 2. å¯åŠ¨å‰ç«¯æœåŠ¡

```bash
cd apps/agendaedu-web
pnpm run dev
```

å‰ç«¯æœåŠ¡å°†åœ¨ `http://localhost:5173` å¯åŠ¨

#### 3. è®¿é—®åŠŸèƒ½

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š
- è¯¾ç¨‹è¡¨: `http://localhost:5173/web/course-calendar`
- å­¦ç”Ÿè¯¾ç¨‹è¡¨: `http://localhost:5173/web/course-calendar/student`

## ğŸ“‹ åŠŸèƒ½è¯´æ˜

### è¯¾ç¨‹è¡¨é¡µé¢

**å·¦ä¾§æ ‘å½¢ç»“æ„**ï¼š
- æ ¹èŠ‚ç‚¹ï¼šå‰æ—è´¢ç»å¤§å­¦è¯¾è¡¨
- ä¸€çº§èŠ‚ç‚¹ï¼šæ‰€æœ‰è¯¾ç¨‹æ—¥å†ï¼ˆæ¥è‡ª `icasync_calendar_mapping` è¡¨ï¼‰
- äºŒçº§èŠ‚ç‚¹ï¼šæ¯ä¸ªæ—¥å†ä¸‹çš„è¯¾ç¨‹ï¼ˆæ¥è‡ª `icasync_attendance_courses` è¡¨ï¼‰

**å³ä¾§è¯¦æƒ…é¢æ¿**ï¼š
- **Tab 1 - æ—¥å†å‚ä¸è€…**ï¼šæ˜¾ç¤ºè¯¥æ—¥å†çš„æ‰€æœ‰å‚ä¸è€…åŠå…¶æƒé™
- **Tab 2 - è¯¾èŠ‚è¯¦æƒ…**ï¼šæ˜¾ç¤ºè¯¥æ—¥å†ä¸‹çš„æ‰€æœ‰è¯¾ç¨‹ä¿¡æ¯

### æ“ä½œæµç¨‹

1. åœ¨å·¦ä¾§æ ‘å½¢ç»“æ„ä¸­ç‚¹å‡»æ—¥å†èŠ‚ç‚¹
2. å³ä¾§è‡ªåŠ¨åŠ è½½è¯¥æ—¥å†çš„å‚ä¸è€…å’Œè¯¾ç¨‹ä¿¡æ¯
3. åˆ‡æ¢ Tab é¡µæŸ¥çœ‹ä¸åŒä¿¡æ¯
4. ç‚¹å‡»æ ‘èŠ‚ç‚¹çš„ç®­å¤´å›¾æ ‡å±•å¼€/æ”¶èµ·å­èŠ‚ç‚¹

## ğŸ”§ API æ¥å£

### 1. è·å–è¯¾ç¨‹æ—¥å†æ ‘

```http
GET /api/icalink/v1/course-calendar/tree
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": {
    "id": "root",
    "label": "å‰æ—è´¢ç»å¤§å­¦è¯¾è¡¨",
    "type": "root",
    "children": [
      {
        "id": "calendar-1",
        "label": "2024-2025å­¦å¹´ç¬¬ä¸€å­¦æœŸ-é«˜ç­‰æ•°å­¦",
        "type": "calendar",
        "calendarId": "cal_xxx",
        "xnxq": "2024-2025-1",
        "children": [...]
      }
    ]
  }
}
```

### 2. è·å–æ—¥å†å‚ä¸è€…

```http
GET /api/icalink/v1/course-calendar/:calendar_id/participants
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": [
    {
      "id": "perm_xxx",
      "calendarId": "cal_xxx",
      "userId": "user_123",
      "role": "owner"
    }
  ]
}
```

### 3. è·å–è¯¾ç¨‹è¯¦æƒ…

```http
GET /api/icalink/v1/course-calendar/:calendar_id/courses
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "courseName": "é«˜ç­‰æ•°å­¦",
      "teachingWeek": 1,
      "weekDay": 1,
      "teacherNames": "å¼ ä¸‰",
      "classLocation": "æ•™å­¦æ¥¼A-101",
      "startTime": "2024-09-01T08:00:00Z",
      "endTime": "2024-09-01T09:40:00Z",
      "attendanceEnabled": true
    }
  ]
}
```

## ğŸ› å¸¸è§é—®é¢˜

### 1. æ ‘å½¢ç»“æ„ä¸ºç©º

**åŸå› **ï¼šæ•°æ®åº“ä¸­æ²¡æœ‰æœªåˆ é™¤çš„æ—¥å†æ˜ å°„æ•°æ®

**è§£å†³æ–¹æ¡ˆ**ï¼š
```sql
-- æ£€æŸ¥æ•°æ®
SELECT * FROM icasync_calendar_mapping WHERE is_deleted = 0;

-- å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œéœ€è¦å…ˆåˆ›å»ºæ—¥å†æ˜ å°„
```

### 2. å‚ä¸è€…åˆ—è¡¨ä¸ºç©º

**åŸå› **ï¼š
- WPS API é…ç½®é”™è¯¯
- æ—¥å†æ²¡æœ‰è®¾ç½®å‚ä¸è€…
- Access Token è¿‡æœŸ

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ `stratix.config.ts` ä¸­çš„ WPS V7 é…ç½®
- åœ¨ WPS æ—¥å†ä¸­æ·»åŠ å‚ä¸è€…
- é‡å¯åç«¯æœåŠ¡åˆ·æ–° Token

### 3. è¯¾ç¨‹è¯¦æƒ…ä¸ºç©º

**åŸå› **ï¼š`icasync_attendance_courses` è¡¨ä¸­æ²¡æœ‰å¯¹åº”çš„è¯¾ç¨‹æ•°æ®

**è§£å†³æ–¹æ¡ˆ**ï¼š
```sql
-- æ£€æŸ¥è¯¾ç¨‹æ•°æ®
SELECT * FROM icasync_attendance_courses 
WHERE course_code = 'å¯¹åº”çš„å¼€è¯¾å·' 
  AND semester = 'å¯¹åº”çš„å­¦å¹´å­¦æœŸ'
  AND deleted_at IS NULL;
```

### 4. æƒé™é”™è¯¯

**åŸå› **ï¼šå½“å‰ç”¨æˆ·æ²¡æœ‰è®¿é—®æƒé™

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿ç”¨æˆ·å…·æœ‰ `teacher`ã€`admin` æˆ– `super_admin` è§’è‰²
- æ£€æŸ¥ JWT Token æ˜¯å¦æœ‰æ•ˆ

## ğŸ“Š æ•°æ®å‡†å¤‡

### ç¤ºä¾‹æ•°æ®æ’å…¥

```sql
-- æ’å…¥æ—¥å†æ˜ å°„ç¤ºä¾‹
INSERT INTO icasync_calendar_mapping (kkh, xnxq, calendar_id, calendar_name, is_deleted)
VALUES ('CS101', '2024-2025-1', 'cal_example_123', 'é«˜ç­‰æ•°å­¦è¯¾ç¨‹æ—¥å†', 0);

-- æ’å…¥è¯¾ç¨‹ç¤ºä¾‹
INSERT INTO icasync_attendance_courses (
  juhe_renwu_id, external_id, course_code, course_name, semester,
  teaching_week, week_day, teacher_names, class_location,
  start_time, end_time, time_period, attendance_enabled
) VALUES (
  1, 'ext_001', 'CS101', 'é«˜ç­‰æ•°å­¦', '2024-2025-1',
  1, 1, 'å¼ ä¸‰', 'æ•™å­¦æ¥¼A-101',
  '2024-09-01 08:00:00', '2024-09-01 09:40:00', 'am', 1
);
```

## ğŸ” è°ƒè¯•æŠ€å·§

### åç«¯æ—¥å¿—

æŸ¥çœ‹åç«¯æ—¥å¿—è¾“å‡ºï¼š
```bash
# åœ¨ app-icalink ç›®å½•ä¸‹
pnpm run dev

# æ—¥å¿—ä¼šæ˜¾ç¤ºï¼š
# âœ… CalendarMappingRepository initialized
# âœ… CourseCalendarService initialized
# âœ… CourseCalendarController initialized
```

### å‰ç«¯è°ƒè¯•

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼š
1. Network æ ‡ç­¾ï¼šæŸ¥çœ‹ API è¯·æ±‚å’Œå“åº”
2. Console æ ‡ç­¾ï¼šæŸ¥çœ‹é”™è¯¯ä¿¡æ¯
3. React DevToolsï¼šæŸ¥çœ‹ç»„ä»¶çŠ¶æ€

### API æµ‹è¯•

ä½¿ç”¨ curl æˆ– Postman æµ‹è¯• APIï¼š

```bash
# æµ‹è¯•æ ‘å½¢ç»“æ„æ¥å£
curl -X GET http://localhost:8090/api/icalink/v1/course-calendar/tree \
  -H "Authorization: Bearer YOUR_TOKEN"

# æµ‹è¯•å‚ä¸è€…æ¥å£
curl -X GET http://localhost:8090/api/icalink/v1/course-calendar/cal_xxx/participants \
  -H "Authorization: Bearer YOUR_TOKEN"

# æµ‹è¯•è¯¾ç¨‹è¯¦æƒ…æ¥å£
curl -X GET http://localhost:8090/api/icalink/v1/course-calendar/cal_xxx/courses \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## ğŸ“ å¼€å‘å»ºè®®

### 1. ä»£ç è§„èŒƒ

- éµå¾ª Stratix æ¡†æ¶çš„åˆ†å±‚æ¶æ„
- ä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹æ¨¡å¼
- ç»Ÿä¸€ä½¿ç”¨ ServiceResult è¿”å›æ ¼å¼
- å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

### 2. æµ‹è¯•å»ºè®®

- ç¼–å†™å•å…ƒæµ‹è¯•è¦†ç›– Repository å’Œ Service å±‚
- ä½¿ç”¨ vitest è¿›è¡Œæµ‹è¯•
- æµ‹è¯•è¾¹ç•Œæƒ…å†µå’Œé”™è¯¯å¤„ç†

### 3. æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨ React Query çš„ç¼“å­˜æœºåˆ¶
- é¿å…ä¸å¿…è¦çš„ API è°ƒç”¨
- å¤§æ•°æ®é‡æ—¶è€ƒè™‘åˆ†é¡µæˆ–è™šæ‹Ÿæ»šåŠ¨

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **å®Œå–„å­¦ç”Ÿè¯¾ç¨‹è¡¨åŠŸèƒ½**ï¼šå®ç°å­¦ç”Ÿä¸ªäººè¯¾ç¨‹è¡¨æŸ¥çœ‹
2. **æ·»åŠ æœç´¢åŠŸèƒ½**ï¼šæ”¯æŒè¯¾ç¨‹åç§°ã€æ•™å¸ˆåç§°æœç´¢
3. **å¯¼å‡ºåŠŸèƒ½**ï¼šæ”¯æŒå¯¼å‡ºä¸º Excel æˆ– PDF
4. **ç§»åŠ¨ç«¯é€‚é…**ï¼šä¼˜åŒ–ç§»åŠ¨ç«¯æ˜¾ç¤ºæ•ˆæœ
5. **å®æ—¶æ›´æ–°**ï¼šä½¿ç”¨ WebSocket å®ç°æ•°æ®å®æ—¶åŒæ­¥

## ğŸ“ è·å–å¸®åŠ©

- æŸ¥çœ‹å®Œæ•´æ–‡æ¡£ï¼š`docs/è¯¾ç¨‹æ—¥å†åŠŸèƒ½å®ç°æ€»ç»“.md`
- Stratix æ¡†æ¶æ–‡æ¡£ï¼šæŸ¥çœ‹é¡¹ç›® README
- æäº¤ Issueï¼šåœ¨é¡¹ç›®ä»“åº“ä¸­åˆ›å»ºé—®é¢˜

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰

