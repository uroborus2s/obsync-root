# WPS äº‘ç›˜è·¯å¾„ä¸Šä¼ åŠŸèƒ½æµ‹è¯•ç¤ºä¾‹

## ğŸ§ª æµ‹è¯•åœºæ™¯

### åœºæ™¯1: ä¸Šä¼ åˆ°æ ¹ç›®å½•ï¼ˆä¸ä½¿ç”¨è·¯å¾„ï¼‰

```typescript
// å‰ç«¯è°ƒç”¨
const result = await wpsDriveApi.uploadFile({
  drive_id: 'q60YOE5',
  parent_id: '0',
  file: new File(['test content'], 'test.txt', { type: 'text/plain' })
});

console.log('æ–‡ä»¶ID:', result.id);
console.log('æ–‡ä»¶å:', result.name);
console.log('å…±äº«é“¾æ¥:', result.shareUrl);
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… æ–‡ä»¶ä¸Šä¼ åˆ°æ ¹ç›®å½•
- âœ… è¿”å›æ–‡ä»¶ä¿¡æ¯å’Œå…±äº«é“¾æ¥
- âœ… ä¸ä½¿ç”¨ `parent_path` å‚æ•°

---

### åœºæ™¯2: ä¸Šä¼ åˆ°æŒ‡å®šè·¯å¾„ï¼ˆå•å±‚ï¼‰

```typescript
const result = await wpsDriveApi.uploadFile({
  drive_id: 'q60YOE5',
  parent_id: '0',
  parent_path: '/documents',
  file: new File(['test content'], 'report.pdf', { type: 'application/pdf' })
});

console.log('æ–‡ä»¶ID:', result.id);
console.log('çˆ¶è·¯å¾„:', result.parent_id);
console.log('å…±äº«é“¾æ¥:', result.shareUrl);
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… æ–‡ä»¶ä¸Šä¼ åˆ° `/documents` è·¯å¾„
- âœ… å¦‚æœ `documents` æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œè‡ªåŠ¨åˆ›å»º
- âœ… è¿”å›æ–‡ä»¶ä¿¡æ¯å’Œå…±äº«é“¾æ¥

**åç«¯æ—¥å¿—**ï¼š
```
[DEBUG] Converted parent_path: {
  original: '/documents',
  array: ['documents']
}
```

---

### åœºæ™¯3: ä¸Šä¼ åˆ°å¤šå±‚è·¯å¾„

```typescript
const result = await wpsDriveApi.uploadFile({
  drive_id: 'q60YOE5',
  parent_id: '0',
  parent_path: '/2024/photos/vacation',
  file: new File(['image data'], 'beach.jpg', { type: 'image/jpeg' })
});

console.log('æ–‡ä»¶ID:', result.id);
console.log('æ–‡ä»¶è·¯å¾„:', '/2024/photos/vacation/beach.jpg');
console.log('å…±äº«é“¾æ¥:', result.shareUrl);
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… æ–‡ä»¶ä¸Šä¼ åˆ° `/2024/photos/vacation` è·¯å¾„
- âœ… å¦‚æœè·¯å¾„ä¸å­˜åœ¨ï¼Œè‡ªåŠ¨åˆ›å»ºæ‰€æœ‰å±‚çº§
- âœ… è¿”å›æ–‡ä»¶ä¿¡æ¯å’Œå…±äº«é“¾æ¥

**åç«¯æ—¥å¿—**ï¼š
```
[DEBUG] Converted parent_path: {
  original: '/2024/photos/vacation',
  array: ['2024', 'photos', 'vacation']
}
```

---

### åœºæ™¯4: è·¯å¾„æ ¼å¼æµ‹è¯•ï¼ˆæ— å¼€å¤´æ–œæ ï¼‰

```typescript
const result = await wpsDriveApi.uploadFile({
  drive_id: 'q60YOE5',
  parent_id: '0',
  parent_path: 'folder1/folder2',  // æ— å¼€å¤´æ–œæ 
  file: new File(['test'], 'test.txt')
});
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… è‡ªåŠ¨å¤„ç†æ— å¼€å¤´æ–œæ çš„è·¯å¾„
- âœ… è½¬æ¢ä¸º `['folder1', 'folder2']`
- âœ… æ–‡ä»¶æ­£å¸¸ä¸Šä¼ 

---

### åœºæ™¯5: è·¯å¾„æ ¼å¼æµ‹è¯•ï¼ˆå¤šä½™æ–œæ ï¼‰

```typescript
const result = await wpsDriveApi.uploadFile({
  drive_id: 'q60YOE5',
  parent_id: '0',
  parent_path: '//folder1///folder2//',  // å¤šä½™æ–œæ 
  file: new File(['test'], 'test.txt')
});
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… è‡ªåŠ¨è¿‡æ»¤å¤šä½™æ–œæ 
- âœ… è½¬æ¢ä¸º `['folder1', 'folder2']`
- âœ… æ–‡ä»¶æ­£å¸¸ä¸Šä¼ 

**åç«¯æ—¥å¿—**ï¼š
```
[DEBUG] Converted parent_path: {
  original: '//folder1///folder2//',
  array: ['folder1', 'folder2']
}
```

---

### åœºæ™¯6: ä¸Šä¼ åˆ°æ–‡ä»¶å¤¹çš„å­è·¯å¾„

```typescript
// å‡è®¾å·²æœ‰æ–‡ä»¶å¤¹ ID: 'folder_abc123'
const result = await wpsDriveApi.uploadFile({
  drive_id: 'q60YOE5',
  parent_id: 'folder_abc123',
  parent_path: '/subfolder1/subfolder2',
  file: new File(['test'], 'test.txt')
});
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… æ–‡ä»¶ä¸Šä¼ åˆ° `folder_abc123` ä¸‹çš„ `/subfolder1/subfolder2` è·¯å¾„
- âœ… å¦‚æœå­è·¯å¾„ä¸å­˜åœ¨ï¼Œè‡ªåŠ¨åˆ›å»º
- âœ… è¿”å›æ–‡ä»¶ä¿¡æ¯å’Œå…±äº«é“¾æ¥

---

## ğŸ“Š FormData å­—æ®µé¡ºåºéªŒè¯

### æ­£ç¡®çš„é¡ºåº

```typescript
const formData = new FormData();
formData.append('parent_id', '0');           // âœ… 1. parent_id
formData.append('parent_path', '/folder1');  // âœ… 2. parent_path
formData.append('file', fileObject);         // âœ… 3. fileï¼ˆæœ€åï¼‰
```

**é¢„æœŸåç«¯æ—¥å¿—**ï¼š
```
========== Processing part 1 ==========
Part type: field
Part fieldname: parent_id
âœ… Found parent_id: 0

========== Processing part 2 ==========
Part type: field
Part fieldname: parent_path
âœ… Found parent_path: /folder1

========== Processing part 3 ==========
Part type: file
Part fieldname: file
âœ… Both parent_id and file found, breaking loop
```

---

## ğŸ” é”™è¯¯åœºæ™¯æµ‹è¯•

### é”™è¯¯1: ç¼ºå°‘ parent_id

```typescript
// âŒ é”™è¯¯ï¼šç¼ºå°‘å¿…éœ€å‚æ•°
await wpsDriveApi.uploadFile({
  drive_id: 'q60YOE5',
  parent_path: '/folder1',
  file: fileObject
});
```

**é¢„æœŸç»“æœ**ï¼š
- âŒ TypeScript ç¼–è¯‘é”™è¯¯ï¼ˆ`parent_id` æ˜¯å¿…éœ€çš„ï¼‰
- âŒ å¦‚æœç»•è¿‡ç±»å‹æ£€æŸ¥ï¼Œåç«¯è¿”å› 400 é”™è¯¯

**åç«¯å“åº”**ï¼š
```json
{
  "success": false,
  "message": "ç¼ºå°‘å¿…éœ€å‚æ•°ï¼šparent_id"
}
```

---

### é”™è¯¯2: ç¼ºå°‘æ–‡ä»¶

```typescript
// âŒ é”™è¯¯ï¼šç¼ºå°‘æ–‡ä»¶
await wpsDriveApi.uploadFile({
  drive_id: 'q60YOE5',
  parent_id: '0',
  parent_path: '/folder1'
  // ç¼ºå°‘ file å‚æ•°
});
```

**é¢„æœŸç»“æœ**ï¼š
- âŒ TypeScript ç¼–è¯‘é”™è¯¯ï¼ˆ`file` æ˜¯å¿…éœ€çš„ï¼‰
- âŒ å¦‚æœç»•è¿‡ç±»å‹æ£€æŸ¥ï¼Œåç«¯è¿”å› 400 é”™è¯¯

**åç«¯å“åº”**ï¼š
```json
{
  "success": false,
  "message": "æœªæ‰¾åˆ°ä¸Šä¼ çš„æ–‡ä»¶"
}
```

---

## ğŸ¯ å®Œæ•´æµ‹è¯•æµç¨‹

### æ­¥éª¤1: å‡†å¤‡æµ‹è¯•ç¯å¢ƒ

```bash
# å¯åŠ¨åç«¯æœåŠ¡
cd apps/app-icalink
pnpm run dev

# å¯åŠ¨å‰ç«¯æœåŠ¡
cd apps/agendaedu-web
pnpm run dev
```

### æ­¥éª¤2: æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°

```
F12 æˆ– Cmd+Option+I
```

### æ­¥éª¤3: æ‰§è¡Œæµ‹è¯•ä»£ç 

```typescript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­æ‰§è¡Œ
const testFile = new File(['æµ‹è¯•å†…å®¹'], 'test.txt', { type: 'text/plain' });

// æµ‹è¯•1: ä¸Šä¼ åˆ°æ ¹ç›®å½•
const result1 = await wpsDriveApi.uploadFile({
  drive_id: 'q60YOE5',
  parent_id: '0',
  file: testFile
});
console.log('æµ‹è¯•1ç»“æœ:', result1);

// æµ‹è¯•2: ä¸Šä¼ åˆ°æŒ‡å®šè·¯å¾„
const result2 = await wpsDriveApi.uploadFile({
  drive_id: 'q60YOE5',
  parent_id: '0',
  parent_path: '/test-folder',
  file: testFile
});
console.log('æµ‹è¯•2ç»“æœ:', result2);

// æµ‹è¯•3: ä¸Šä¼ åˆ°å¤šå±‚è·¯å¾„
const result3 = await wpsDriveApi.uploadFile({
  drive_id: 'q60YOE5',
  parent_id: '0',
  parent_path: '/2024/test/subfolder',
  file: testFile
});
console.log('æµ‹è¯•3ç»“æœ:', result3);
```

### æ­¥éª¤4: éªŒè¯ç»“æœ

1. **æ£€æŸ¥åç«¯æ—¥å¿—**ï¼š
   - æŸ¥çœ‹è·¯å¾„è½¬æ¢æ—¥å¿—
   - ç¡®è®¤ FormData å­—æ®µé¡ºåºæ­£ç¡®
   - ç¡®è®¤æ–‡ä»¶ä¸Šä¼ æˆåŠŸ

2. **æ£€æŸ¥è¿”å›å€¼**ï¼š
   - `result.id` - æ–‡ä»¶ID
   - `result.name` - æ–‡ä»¶å
   - `result.shareUrl` - å…±äº«é“¾æ¥
   - `result.shareEnabled` - å…±äº«çŠ¶æ€

3. **æ£€æŸ¥ WPS äº‘ç›˜**ï¼š
   - ç™»å½• WPS äº‘ç›˜
   - éªŒè¯æ–‡ä»¶æ˜¯å¦åœ¨æ­£ç¡®çš„è·¯å¾„
   - éªŒè¯å…±äº«é“¾æ¥æ˜¯å¦æœ‰æ•ˆ

---

## ğŸ“ æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] ä¸Šä¼ åˆ°æ ¹ç›®å½•ï¼ˆä¸ä½¿ç”¨ `parent_path`ï¼‰
- [ ] ä¸Šä¼ åˆ°å•å±‚è·¯å¾„ï¼ˆ`/folder1`ï¼‰
- [ ] ä¸Šä¼ åˆ°å¤šå±‚è·¯å¾„ï¼ˆ`/folder1/folder2/folder3`ï¼‰
- [ ] è·¯å¾„æ— å¼€å¤´æ–œæ ï¼ˆ`folder1/folder2`ï¼‰
- [ ] è·¯å¾„æœ‰å¤šä½™æ–œæ ï¼ˆ`//folder1///folder2//`ï¼‰
- [ ] ä¸Šä¼ åˆ°æ–‡ä»¶å¤¹çš„å­è·¯å¾„
- [ ] éªŒè¯å…±äº«é“¾æ¥è¿”å›
- [ ] éªŒè¯å…±äº«é“¾æ¥å¯è®¿é—®
- [ ] é”™è¯¯åœºæ™¯ï¼šç¼ºå°‘ `parent_id`
- [ ] é”™è¯¯åœºæ™¯ï¼šç¼ºå°‘ `file`
- [ ] FormData å­—æ®µé¡ºåºæ­£ç¡®
- [ ] åç«¯æ—¥å¿—è¾“å‡ºæ­£ç¡®

---

## ğŸ‰ é¢„æœŸæˆåŠŸæ ‡å¿—

1. âœ… æ‰€æœ‰æµ‹è¯•åœºæ™¯éƒ½èƒ½æˆåŠŸä¸Šä¼ 
2. âœ… è·¯å¾„è½¬æ¢æ­£ç¡®ï¼ˆåç«¯æ—¥å¿—æ˜¾ç¤ºï¼‰
3. âœ… æ–‡ä»¶å‡ºç°åœ¨æ­£ç¡®çš„è·¯å¾„
4. âœ… å…±äº«é“¾æ¥æœ‰æ•ˆä¸”å¯è®¿é—®
5. âœ… é”™è¯¯åœºæ™¯æ­£ç¡®å¤„ç†
6. âœ… æ—  TypeScript ç±»å‹é”™è¯¯
7. âœ… æ— åç«¯è¿è¡Œæ—¶é”™è¯¯

---

**æµ‹è¯•å®Œæˆåï¼Œè¯·åœ¨æ­¤è®°å½•æµ‹è¯•ç»“æœï¼** âœï¸

