# 日志轮转配置文件
# 用于管理应用和 Nginx 日志

# 应用日志轮转
/app/logs/*.log {
    daily
    missingok
    rotate 7
    compress
    delaycompress
    notifempty
    create 644 root root
    postrotate
        # 发送 USR1 信号给应用进程重新打开日志文件
        pkill -USR1 node || true
    endscript
}

# Nginx 访问日志轮转
/var/log/nginx/*_access.log {
    daily
    missingok
    rotate 14
    compress
    delaycompress
    notifempty
    create 644 www-data www-data
    sharedscripts
    postrotate
        # 重新加载 Nginx 配置
        nginx -s reload || true
    endscript
}

# Nginx 错误日志轮转
/var/log/nginx/*_error.log {
    daily
    missingok
    rotate 14
    compress
    delaycompress
    notifempty
    create 644 www-data www-data
    sharedscripts
    postrotate
        nginx -s reload || true
    endscript
}
