# ObSync 部署配置文件
# 配置部署行为和选项

# 默认环境
DEFAULT_ENVIRONMENT="prod"

# 静态文件编译配置
NODE_ENV="production"
BUILD_TIMEOUT="600"  # 编译超时时间 (秒)

# agendaedu-web 配置
WEB_SOURCE_DIR="$SCRIPT_DIR/../../apps/agendaedu-web"
WEB_BUILD_DIR="$WEB_SOURCE_DIR/dist"
WEB_BUILD_COMMAND="pnpm run build"
WEB_INSTALL_COMMAND="pnpm install"

# agendaedu-app 配置
APP_SOURCE_DIR="$SCRIPT_DIR/../../apps/agendaedu-app"
APP_BUILD_DIR="$APP_SOURCE_DIR/dist"
APP_BUILD_COMMAND="pnpm run build"
APP_INSTALL_COMMAND="pnpm install"

# SSL 证书配置
SSL_SOURCE_DIR="$SCRIPT_DIR/ssl"
SSL_CERT_FILE="STAR_jlufe_edu_cn.pem"
SSL_KEY_FILE="STAR_jlufe_edu_cn.key"

# Nginx 配置
NGINX_SOURCE_DIR="$SCRIPT_DIR/nginx"
MAIN_SERVER_SITE_NAME="kwps.jlufe.edu.cn"
BACKUP_SERVER_SITE_NAME="server-2-internal"

# Docker Compose 统一配置
DOCKER_COMPOSE_SOURCE_DIR="$SCRIPT_DIR/docker-compose"
DOCKER_COMPOSE_MAIN_SERVER="$DOCKER_COMPOSE_SOURCE_DIR/main-server.yml"
DOCKER_COMPOSE_BACKUP_SERVER="$DOCKER_COMPOSE_SOURCE_DIR/backup-server.yml"
DOCKER_COMPOSE_TARGET_DIR="/opt/obsync/docker"
DOCKER_COMPOSE_TARGET_FILE="$DOCKER_COMPOSE_TARGET_DIR/docker-compose.yml"

# 后端应用配置
BACKEND_APPS_BASE_DIR="$SCRIPT_DIR/../../apps"

# API Gateway 配置
API_GATEWAY_SOURCE_DIR="$BACKEND_APPS_BASE_DIR/api-gateway"
API_GATEWAY_BUILD_SCRIPT="$API_GATEWAY_SOURCE_DIR/build.sh"
API_GATEWAY_PROJECT_NAME="stratix-gateway"
API_GATEWAY_CONTAINER_NAMES="api-gateway-1 api-gateway-2"

# 版本策略配置
# 可选值: auto, package, timestamp, latest
# auto: package.json 版本 + git hash (推荐)
# package: 仅使用 package.json 版本
# timestamp: 时间戳 + git hash
# latest: 使用 latest 标签
API_GATEWAY_VERSION_STRATEGY="auto"

# 版本推送策略
# true: 同时推送具体版本号和 latest 标签
# false: 仅推送具体版本号
API_GATEWAY_PUSH_LATEST="true"

# 部署时使用的镜像标签策略
# version: 使用具体版本号拉取 (推荐，便于版本追踪)
# latest: 使用 latest 标签拉取
API_GATEWAY_DEPLOY_TAG_STRATEGY="version"

# ICA Sync 配置
ICASYNC_SOURCE_DIR="$BACKEND_APPS_BASE_DIR/app-icasync"
ICASYNC_BUILD_SCRIPT="$ICASYNC_SOURCE_DIR/build.sh"
ICASYNC_PROJECT_NAME="app-icasync"
ICASYNC_CONTAINER_NAMES="app-icasync"

# Docker 仓库配置
DOCKER_REGISTRY="g-rrng9518-docker.pkg.coding.net"
DOCKER_NAMESPACE="obsync/sync"
DOCKER_USERNAME="sync-1750080420644"
DOCKER_PASSWORD="483742128078285bba00ae2fae50fe10f8458a26"

# 备份配置
DOCKER_BACKUP_DIR="/opt/obsync/backups/docker"

# 备份配置
BACKUP_ENABLED="true"
BACKUP_RETENTION_DAYS="30"

# 部署选项
VERIFY_DEPLOYMENT="true"
RESTART_SERVICES="true"
SEND_NOTIFICATIONS="false"

# 日志配置
LOG_LEVEL="INFO"  # DEBUG, INFO, WARN, ERROR
LOG_TO_FILE="true"
