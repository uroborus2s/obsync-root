# 课程表同步打卡应用系统 - 生产环境部署测试Checklist

## 系统架构概览

**核心应用组件：**
- **@stratix/gateway** - API网关应用 (端口: 8090)
- **@wps/app-icalink** - 签到服务应用 (端口: 8090) 
- **@wps/app-icasync** - 课程表同步应用 (端口: 3001)
- **@wps/agendaedu-web** - Web管理后台 (静态文件)
- **@wps/agendaedu-app** - 移动端打卡应用 (静态文件)

**基础设施：**
- 2台云服务器 (Server-1, Server-2)
- 云MySQL数据库
- 云Redis缓存
- Nginx负载均衡器

---

## 阶段一：部署前准备 (Pre-Deployment)

### 1.1 环境基础设施检查

#### 1.1.1 服务器环境验证
- [ ] **服务器规格确认**
  - [ ] Server-1: CPU ≥ 4核, 内存 ≥ 16GB, 磁盘 ≥ 300GB
  - [ ] Server-2: CPU ≥ 4核, 内存 ≥ 16GB, 磁盘 ≥ 300GB
  - [ ] 操作系统: Ubuntu 22.04
  - [ ] 系统时间同步配置正确

- [ ] **网络连通性测试**
  - [ ] 服务器间内网互通 (ping测试)
  - [ ] 服务器到数据库连通性 (telnet 10.0.2.100 3306)
  - [ ] 服务器到Redis连通性 (telnet 10.0.2.212 6379)
  - [ ] 外网访问测试 (curl外部API)

#### 1.1.2 Docker环境准备
- [ ] **Docker安装验证**
  - [ ] Server-1: Docker版本 28.3 (`docker --version`)
  - [ ] Server-2: Docker版本 28.3 (`docker --version`)
  - [ ] Docker Compose版本 2.39 (`docker-compose --version`)
  - [ ] Docker服务运行状态正常 (`systemctl status docker`)

- [ ] **Docker配置优化**
  - [ ] 设置Docker日志轮转策略
  - [ ] 配置Docker存储驱动优化
  - [ ] 验证Docker网络配置

#### 1.1.3 数据库环境验证
- [ ] **MySQL云数据库检查**
  - [ ] 数据库版本  5.7
  - [ ] 字符集设置为 utf8mb4
  - [ ] 时区设置正确 (Asia/Shanghai)
  - [ ] 最大连接数配置 ≥ 1000
  - [ ] 慢查询日志开启
  - [ ] 二进制日志开启 (用于备份恢复)

- [ ] **数据库用户权限配置**
  - [ ] admin用户权限验证 (icalink库)
  - [ ] admin用户权限验证 (syncdb库)
  - [ ] 数据库连接池配置测试
  - [ ] 数据库备份策略确认

#### 1.1.4 Redis缓存环境验证
- [ ] **Redis配置检查**
  - [ ] Redis版本 4
  - [ ] 内存配置 ≥ 2GB
  - [ ] 持久化策略配置 (RDB + AOF)
  - [ ] 最大连接数配置
  - [ ] 密码认证配置

### 1.2 应用构建准备

#### 1.2.1 代码版本管理
- [ ] **代码仓库状态**
  - [ ] 生产分支代码最新且稳定
  - [ ] 所有依赖包版本锁定 (pnpm-lock.yaml)
  - [ ] 构建脚本测试通过
  - [ ] 代码质量检查通过 (ESLint)

#### 1.2.2 环境配置文件准备
- [ ] **生产环境配置**
  - [ ] prod.env.json配置文件完整性检查
  - [ ] 数据库连接信息正确性验证
  - [ ] API密钥和证书配置验证
  - [ ] 日志级别和路径配置确认

#### 1.2.3 Docker镜像构建
- [ ] **镜像构建测试**
  - [ ] @stratix/gateway镜像构建成功
  - [ ] @wps/app-icalink镜像构建成功  
  - [ ] @wps/app-icasync镜像构建成功
  - [ ] 镜像大小合理 (< 500MB)
  - [ ] 镜像安全扫描通过

### 1.3 负载均衡器配置

#### 1.3.1 Nginx配置准备
- [ ] **Nginx安装和配置**
  - [ ] Nginx版本 1.24
  - [ ] SSL证书配置正确
  - [ ] 负载均衡策略配置 (轮询/权重)
  - [ ] 健康检查配置
  - [ ] 静态文件服务配置

- [ ] **安全配置**
  - [ ] 防火墙规则配置
  - [ ] 访问日志配置
  - [ ] 错误页面配置
  - [ ] 请求限制配置

---

## 阶段二：部署过程 (Deployment Process)

### 2.1 基础服务部署

#### 2.1.1 Docker网络创建
- [ ] **网络环境设置**
  - [ ] 创建应用专用Docker网络
  - [ ] 网络连通性测试
  - [ ] DNS解析配置验证

#### 2.1.2 数据库初始化
- [ ] **数据库结构部署**
  - [ ] 执行数据库迁移脚本
  - [ ] 初始化数据导入
  - [ ] 数据库索引创建
  - [ ] 数据完整性验证

### 2.2 应用服务部署

#### 2.2.1 后端服务部署 (Server-1)
- [ ] **API网关部署**
  - [ ] @stratix/gateway容器启动成功
  - [ ] 健康检查端点响应正常 (/health)
  - [ ] 日志输出正常
  - [ ] 内存和CPU使用率正常

- [ ] **签到服务部署**
  - [ ] @wps/app-icalink容器启动成功
  - [ ] 数据库连接正常
  - [ ] API接口响应正常
  - [ ] WPS API集成测试通过

#### 2.2.2 后端服务部署 (Server-2)
- [ ] **课程表同步服务部署**
  - [ ] @wps/app-icasync容器启动成功
  - [ ] 同步任务调度正常
  - [ ] 数据库连接正常
  - [ ] 日志记录完整

#### 2.2.3 前端应用部署
- [ ] **Web管理后台部署**
  - [ ] @wps/agendaedu-web静态文件部署
  - [ ] Nginx配置生效
  - [ ] 页面访问正常
  - [ ] 静态资源加载正常

- [ ] **移动端应用部署**
  - [ ] @wps/agendaedu-app静态文件部署
  - [ ] 移动端适配正常
  - [ ] WPS协作JSAPI集成正常

### 2.3 负载均衡配置

#### 2.3.1 Nginx负载均衡
- [ ] **负载均衡配置**
  - [ ] 上游服务器配置正确
  - [ ] 健康检查配置生效
  - [ ] 会话保持配置 (如需要)
  - [ ] SSL终止配置正确

---

## 阶段三：部署后验证 (Post-Deployment Verification)

### 3.1 功能测试

#### 3.1.1 基础功能验证
- [ ] **用户认证功能**
  - [ ] WPS OAuth登录流程正常
  - [ ] JWT Token生成和验证正常
  - [ ] 用户权限控制正常
  - [ ] 会话管理正常

#### 3.1.2 核心业务功能
- [ ] **课程表同步功能**
  - [ ] 外部系统数据同步正常
  - [ ] 数据转换和存储正确
  - [ ] 同步日志记录完整
  - [ ] 异常处理机制正常

- [ ] **签到打卡功能**
  - [ ] 地理位置获取正常
  - [ ] 签到时间验证正确
  - [ ] 签到状态更新正常
  - [ ] 请假申请流程正常

#### 3.1.3 管理后台功能
- [ ] **数据查询功能**
  - [ ] 同步工作流状态查询正常
  - [ ] 打卡统计数据显示正确
  - [ ] 数据导出功能正常
  - [ ] 报表生成功能正常

### 3.2 性能测试

#### 3.2.1 负载测试
- [ ] **并发用户测试**
  - [ ] 100并发用户签到测试通过
  - [ ] 500并发用户查询测试通过
  - [ ] 响应时间 < 2秒 (95%请求)
  - [ ] 系统资源使用率 < 80%

#### 3.2.2 压力测试
- [ ] **极限负载测试**
  - [ ] 峰值负载测试 (预期负载的2倍)
  - [ ] 长时间运行稳定性测试 (24小时)
  - [ ] 内存泄漏检测
  - [ ] 数据库连接池压力测试

### 3.3 安全测试

#### 3.3.1 网络安全
- [ ] **防火墙配置验证**
  - [ ] 只开放必要端口 (80, 443, 22)
  - [ ] 内网服务端口不对外暴露
  - [ ] DDoS防护配置生效
  - [ ] 访问控制列表配置正确

#### 3.3.2 应用安全
- [ ] **安全漏洞扫描**
  - [ ] SQL注入防护测试
  - [ ] XSS攻击防护测试
  - [ ] CSRF防护测试
  - [ ] 敏感信息泄露检查

### 3.4 容灾测试

#### 3.4.1 单点故障测试
- [ ] **服务器故障模拟**
  - [ ] Server-1故障时系统可用性
  - [ ] Server-2故障时系统可用性
  - [ ] 数据库连接故障恢复
  - [ ] Redis缓存故障恢复

#### 3.4.2 网络故障测试
- [ ] **网络中断模拟**
  - [ ] 服务器间网络中断恢复
  - [ ] 外部API调用失败处理
  - [ ] 负载均衡器故障切换
  - [ ] DNS解析故障处理

---

## 阶段四：监控和日志配置

### 4.1 应用监控配置

#### 4.1.1 健康检查监控
- [ ] **服务健康状态监控**
  - [ ] 各服务健康检查端点配置
  - [ ] 服务状态监控告警配置
  - [ ] 自动重启策略配置
  - [ ] 监控数据可视化配置

#### 4.1.2 性能指标监控
- [ ] **系统性能监控**
  - [ ] CPU使用率监控告警
  - [ ] 内存使用率监控告警
  - [ ] 磁盘空间监控告警
  - [ ] 网络流量监控

#### 4.1.3 业务指标监控
- [ ] **业务数据监控**
  - [ ] 签到成功率监控
  - [ ] 同步任务成功率监控
  - [ ] API响应时间监控
  - [ ] 错误率监控告警

### 4.2 日志管理配置

#### 4.2.1 日志收集配置
- [ ] **应用日志配置**
  - [ ] 各服务日志级别配置正确
  - [ ] 日志格式标准化
  - [ ] 日志轮转策略配置
  - [ ] 日志持久化存储配置

#### 4.2.2 日志分析配置
- [ ] **日志监控告警**
  - [ ] 错误日志监控告警
  - [ ] 异常模式识别配置
  - [ ] 日志查询和分析工具配置
  - [ ] 日志备份策略配置

---

## 阶段五：回滚方案和故障处理

### 5.1 回滚准备

#### 5.1.1 版本回滚方案
- [ ] **应用版本回滚**
  - [ ] 前一版本Docker镜像保留
  - [ ] 数据库结构回滚脚本准备
  - [ ] 配置文件版本管理
  - [ ] 回滚操作手册准备

#### 5.1.2 数据备份验证
- [ ] **数据安全保障**
  - [ ] 部署前数据库完整备份
  - [ ] 备份数据完整性验证
  - [ ] 备份恢复流程测试
  - [ ] 数据恢复时间评估

### 5.2 故障处理流程

#### 5.2.1 故障响应机制
- [ ] **应急响应流程**
  - [ ] 故障检测和告警机制
  - [ ] 故障分级和响应时间定义
  - [ ] 应急联系人和通知机制
  - [ ] 故障处理操作手册

#### 5.2.2 常见故障处理
- [ ] **故障处理预案**
  - [ ] 服务无响应处理流程
  - [ ] 数据库连接失败处理
  - [ ] 内存溢出处理流程
  - [ ] 磁盘空间不足处理

---

## 阶段六：上线验收

### 6.1 业务验收测试

#### 6.1.1 端到端业务流程
- [ ] **完整业务流程验证**
  - [ ] 用户登录 → 课程查看 → 签到打卡完整流程
  - [ ] 管理员登录 → 数据查询 → 报表导出完整流程
  - [ ] 课程表同步 → 数据处理 → 状态更新完整流程
  - [ ] 异常情况处理流程验证

#### 6.1.2 用户体验验证
- [ ] **用户界面和体验**
  - [ ] 移动端响应式设计正常
  - [ ] 页面加载速度 < 3秒
  - [ ] 用户操作流畅性验证
  - [ ] 错误提示信息友好性

### 6.2 运维验收

#### 6.2.1 运维工具验证
- [ ] **运维管理工具**
  - [ ] 监控面板数据准确性
  - [ ] 日志查询工具可用性
  - [ ] 告警通知机制有效性
  - [ ] 运维操作手册完整性

#### 6.2.2 文档交付
- [ ] **技术文档交付**
  - [ ] 系统架构文档
  - [ ] 部署操作手册
  - [ ] 故障处理手册
  - [ ] 运维监控手册

### 6.3 性能基线确立

#### 6.3.1 性能基线数据
- [ ] **系统性能基线**
  - [ ] 正常负载下响应时间基线
  - [ ] 系统资源使用率基线
  - [ ] 数据库性能指标基线
  - [ ] 网络流量基线数据

---

## 部署完成确认

### 最终检查清单
- [ ] **所有服务正常运行**
  - [ ] 5个核心应用全部启动成功
  - [ ] 负载均衡器配置生效
  - [ ] 数据库和缓存连接正常
  - [ ] 监控和日志系统正常

- [ ] **业务功能验证通过**
  - [ ] 核心业务流程测试通过
  - [ ] 性能测试达到预期指标
  - [ ] 安全测试无重大风险
  - [ ] 容灾测试验证通过

- [ ] **运维保障到位**
  - [ ] 监控告警配置完成
  - [ ] 日志管理系统正常
  - [ ] 回滚方案准备就绪
  - [ ] 运维文档交付完成

## 附录

### A. 关键配置参数
- API网关端口: 8090
- 签到服务端口: 8090  
- 同步服务端口: 3001
- 数据库: MySQL 5.7 (icalink, syncdb)
- 缓存: Redis 6.0+
- 负载均衡: Nginx
